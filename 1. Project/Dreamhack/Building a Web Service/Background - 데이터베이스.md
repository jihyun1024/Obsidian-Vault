## 들어가며
---
문서를 보관하거나, 자료를 정리할 때 서류 보관함을 사용한다. 이처럼, 컴퓨터도 다양한 데이터를 기록하기 위해 **데이터베이스**를 사용하며, 이를 체계적으로 관리하는 프로그램은 **DataBase Management System(DBMS)** 라고 한다. 

이번 강의에서는 HTML과 Flask를 사용해 로그인 기능과 게시판 기능을 가지는 웹 사이트를 구현해 볼 것이다. 그 과정에서 데이터베이스도 함께 사용할 것이기 때문에, 이번에는 우선 배경지식을 학습하고 넘어간다. 


## DataBase Management System(DBMS)
---
웹 서비스는 데이터베이스에 정보를 저장하고 이를 관리하기 위해 **Database Management System**을 사용한다. DBMS는 데이터베이스에 새로운 정보를 기록하거나 기록된 내용을 수정, 삭제하는 역할을 수행한다. DBMS는 다수의 사용자가 동시에 하나의 데이터베이스에 접근할 수 있고, 웹 서비스의 검색 기능처럼 복잡한 요구사항을 만족하는 데이터를 조회할 수 있다. 

DBMS는 크게 관계형(Relational)과 비관계형(Non-Relational)을 기준으로 나눌 수 있으며, 그 외에도 다양한 종류의 DBMS가 존재한다. 

- Relational: MySQL, MariaDB, PostgreSQL, SQLite
- Non-Relational: MongoDB, CouchDB, Redis

두 DBMS 유형의 가장 큰 차이점은 관계형은 **행과 열의 집합인 테이블 형식**으로 데이터를 저장하고, 비관계형은 테이블 형식이 아닌 **키-값** 형태로 값을 저장한다는 점이다.


## Relational DBMS(RDBMS)
---
두 DBMS 유형 중, Relational DBMS(RDBMS)는 데이터를 표의 형식으로 저장하고 관리하는 데이터베이스 모델로, 1970년 Codds가 제안한 RDBMS로 간주되기 위한 12가지 규칙에 기반해 정의되었다. 그러나, 실제로는 <u>가장 핵심적인 조건 두 가지를 충족하는</u> 시스템을 RDBMS로 분류한다. 

1. RDBMS는 <u>행(Row)과 열(Column)</u>의 집합으로 구성된 **테이블**의 묶음 형식으로 데이터를 관리
2. 테이블 형식의 데이터를 조작할 수 있는 **관계 연산자**를 제공

RDBMS에서 관계 연산자는 <u>Structured Query Language (SQL)</u>라는 쿼리 언어를 사용해 이루어지며, 쿼리를 통해 테이블 형식의 데이터를 조작한다. 

메이플스토리의 예시로 RDBMS의 이해를 해 보면, 메이플스토리의 데이터베이스에는 다양한 정보를 담는 여러 테이블이 다음과 같이 존재할 수 있다. 

**유저 정보 테이블**

| 유저 ID(문자열) | 이름(문자열) | 가입일(날짜)    | 전화번호(문자열)     |
| ---------- | ------- | ---------- | ------------- |
| CS31337    | 쌀숭이     | 2024.02.01 | 010-1337-1337 |
| CS31338    | 신창섭     | 2009.09.01 | 010-8864-3254 |
**장비 정보 테이블**

| 이름(문자열)    | 무기 상수(부동소수점) | 종류(문자열) | 사용 직업(문자열) |
| ---------- | ------------ | ------- | ---------- |
| 제네시스 스피어   | 1.49         | 창       | 다크나이트      |
| 도전자의 데스페라도 | 1.30         | 데스페라도   | 데몬어벤져      |
| 데스티니 샤이닝로드 | 1.20         | 샤이닝 로드  | 루미너스       |
이때 유저 정보, 장비 정보는 서로 다른 테이블에 저장되며, 이 외에도 치장 아이템이나 주문 내역 등의 테이블도 존재할 수 있다. 이 테이블들은 서로 연관되어 있지는 않지만, <u>주문 내역 테이블과 유저 정보 테이블</u>의 경우, 공통된 키인 유저 ID를 **고유 키**로 기준 삼아 서로 연관될 수 있다. 

여기서, "서로 연관된다"는 말의 의미는 다음과 같다. 유저 ID는 각각의 유저를 구별하는 데 사용되는 고유 식별자로, 유저 ID를 통해 해당하는 유저의 가입일이나 주문 날짜, 상품 후기 등을 쉽게 조회할 수 있다. 


## SQLite
---
### 실습: SQLite를 통한 SQL 실습
---
![[Pasted image 20260110214455.png]]

[SQLite](https://www.sqlite.org/)는 배우기 쉽고 가벼운 관계형 데이터베이스 관리 시스템(RDBMS)으로, 다른 데이터베이스처럼 복잡한 서버 설정 없이도 사용할 수 있어 학습용 프로젝트, 소규모 프로젝트, [[Proton Pass 기능 정리 및 아티팩트 분석|Proton Pass]] 등의 모바일 앱 등에서 널리 사용된다. 

이번 장에서는 SQLite를 설치한 후 실습을 통해 데이터를 저장하고 관리하는 방법을 익혀 보면서 데이터베이스의 기초를 배워 본다.

### 실습: SQLite 설치하기
---
강의에서 기준으로 하는 환경인 Ubuntu Linux 64-bit에서는 다음 명령어를 터미널에서 실행한다. 

```shell
$ sudo apt-get update -y
$ sudo apt-get install sqlite3 -y
```

해당 명령어를 실행한 결과는 다음과 같다. 

![[Pasted image 20260110232749.png]]
프로그램이 제대로 설치되었는지 확인하려면, `$ sqlite3` 명령어를 터미널에서 실행하면 프로그램이 켜지고 커서에 `sqlite>`라는 프롬프트가 표시된다. 콘솔에서 나가고 싶은 경우 Ctrl + D를 누르거나, `.exit` 또는 `.quit` 명령어를 입력하면 된다. 

![[Pasted image 20260110233910.png]]
### 실습: 데이터베이스 생성하기
---
SQLite에서 데이터베이스는 하나의 파일로 관리된다. 

1. 터미널을 켜고 비어있는 디렉터리에서 `sqlite3 my_database.db` 명령어를 실행한다. 
	- 새로운 데이터를 *my_database.db*라는 이름의 파일로 생성한다.
2. 실행하면 SQLite 콘솔로 진입하며, 커서에 `sqlite>`라는 프롬프트가 표시된다.


### 테이블 생성하기
---
이제 데이터베이스에 데이터를 저장할 테이블을 만들어야 한다. 테이블은 데이터베이스에서 **데이터를 저장하는 기본 단위**로, Excel에서의 시트나 스프레드시트를 떠올리면 쉽게 이해할 수 있다. 테이블은 행과 열로 이루어져 있으며, <u>각 행에는 하나의 데이터 레코드가, 각 열에는 데이터의 속성이 저장</u>된다. 

예를 들어, 학생 정보를 저장하는 테이블의 경우, 행에는 학생 한 명 한 명의 실제 정보가, 열에는 학생 고유 ID, 전화번호, 이름 등이 들어있게 된다. 

SQLite에서 데이터베이스에 테이블을 생성하려면 `CREATE TABLE`이라는 명령어를 사용한다. 

```sqlite
CREATE TABLE 테이블_이름 (
	열_이름 데이터_유형 제약조건,
	열_이름 데이터_유형 제약조건,
	...
);
```

- 테이블 이름
	- 생성할 테이블의 이름으로, 데이터베이스 내에서 고유해야 함
- 열 이름
	- 테이블에서 데이터를 저장할 속성의 이름
- 데이터 유형
	- 해당 열에 저장할 데이터의 유형
	- `INTEGER`: 정수형
	- `TEXT`: 문자열 데이터
	- `REAL`: 실수형 데이터
	- `DATE`: 날짜 데이터
- 제약조건
	- 데이터의 유효성을 검사하는 규칙을 지정
	- `PRIMARY_KEY`: 각 행을 고유하게 식별하는 역할
	- `NOT NULL`: 값이 반드시 입력되어야 함
	- `UNIQUE`: 값이 중복되면 안 됨
	- `DEFAULT`: 기본값을 지정


### 실습: 테이블 생성하기
---
데이터베이스에 `students` 테이블을 생성하면서 감을 익혀 보도록 한다. 

먼저, *my_database.db*의 SQLite 콘솔에서 다음 SQL 명령어를 그대로 입력해 실행한다. 

```sqlite
CREATE TABLE students (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    age INTEGER
);
```

위 SQL 명령어를 실행한 후의 모습은 다음과 같다. 

![[Pasted image 20260110235623.png]]
실행한 명령어를 한 줄씩 분석해 보면 다음과 같다. 

- `CREATE TABLE students (`: `students`라는 이름의 테이블을 *my_database.db* 내에 만든다.
- `id INTEGER PRIMARY_KEY,`: `id`라는 이름의 필드를 정수형으로 만들며, `PRIMARY_KEY`이므로 데이터의 **고유 키**로 사용된다.
- `name TEXT NOT NULL,`: `name`이라는 이름의 필드를 텍스트 형태의 데이터를 담을 수 있도록 만들며, `NOT NULL`이므로 빈 데이터가 들어갈 수 없다.
- `age INTEGER`: `age`라는 이름의 필드를 정수형으로 만든다.
- `);`: 테이블 생성 구문을 완성시키고 실행한다.

>[!example] 고유 키란?
>테이블의 특정 행을 고유하게 식별할 수 있는 필드로 설정하는 것으로, 고유 키로 설정된 필드에는 중복된 값이 저장될 수 없다. 
>
>앞서 숫자 형태의 데이터를 담는 `id`라는 필드를 고유 키로 설정했는데, 이는 `id`가 1인 학생이 이미 존재하는 상황에서 `id`가 1인 학생을 새롭게 추가하려 하면 데이터베이스에서 오류가 일어나 데이터가 추가되지 않는다.
>
>이처럼, `id`를 고유 키로 설정함으로써 각 학생마다 고유한 `id`값을 가지게 만들 수 있다. 따라서 `id` 필드를 사용해 각 학생을 식별할 수 있다. 

이어서, 다음의 SQL 명령어를 실행하면 `students` 테이블이 잘 생성되었는지 확인할 수 있다. 

```sqlite
PRAGMA table_info(students);
```

위 명령어를 실행한 후의 모습은 다음과 같다. 

![[Pasted image 20260111000831.png]]
### 데이터 추가하기
---
이제 테이블도 만들었으니, 테이블에 데이터를 추가해야 한다. `INSERT INTO`는 **테이블에 새로운 데이터를 삽입하는 SQL 명령어**로, 테이블에 정의된 각 열(필드)에 따라 데이터를 추가할 수 있다. 기본 문법은 아래와 같다. 

```sqlite
INSERT INTO 테이블_이름 (열1, 열2, 열3, ...) VALUES (값1, 값2, 값3, ...);
```

### 실습: 데이터 추가하기
---
문법으로만 보면 명령어를 어떻게 사용해야 하는지 잘 와닿지 않기 때문에 직접 실습하며 감을 익혀본다. `students` 테이블에 다음 세 명의 학생 정보를 추가해 보자. 

| 학생 이름     | 나이  |
| --------- | --- |
| Amo Kim   | 13  |
| Boko Park | 15  |
| Nando Lee | 14  |

각 학생의 정보는 다음 순서대로 SQL 명령어를 수행하면 된다. 

```sqlite
INSERT INTO students (name, age) VALUES ('Amo Kim', 13)
INSERT INTO students (name, age) VALUES ('Boko Park', 15)
INSERT INTO students (name, age) VALUES ('Nando Lee', 14)
```

위 명령어들을 수행한 이후의 모습은 다음과 같다. (명령어 분석은 굳이 하지 않는다)

![[Pasted image 20260111014444.png]]
이 때 `id` 필드는 어디다 팔아먹었냐고 궁금해 할 수 있는데, `id` 필드는 `PRIMARY KEY`로 사용되기 때문에 데이터베이스가 알아서 값을 지정해 준다. 따라서 별도로 값을 지정하지 않아도 된다.


### 데이터 조회하기
---
이제 테이블에 저장된 데이터를 조회하는 방법을 알아보자. `SELECT`는 데이터를 조회하기 위해 사용하는 가장 기본적이고 중요한 명령어로, 저장된 정보를 원하는 대로 필터링해서 조회할 수 있다. 기본 문법은 다음과 같다. 

```sqlite
SELECT 열_이름1, 열_이름2, 열_이름3, ... FROM 테이블_이름;
```


### 실습: 데이터 조회하기
---
이것도 데이터를 조회하는 실습을 통해 문법에 익숙해지도록 한다. 모든 학생의 정보를 조회하는 것과 특정 `id`값을 가진 학생만 조회하는 두 가지 실습을 진행한다. 

**모든 학생 정보 조회**
다음 SQL 명령어를 복사한 후 SQLite 콘솔에 붙여 넣어 모든 학생 정보를 조회한다. 

```sqlite
SELECT * FROM students;
```

위 명령어를 실행하면 다음과 같이 출력된다. 

![[Pasted image 20260111015103.png]]
**특정 `id` 값을 가진 학생만 조회**
`id`가 2인 학생의 정보만 조회하려면, 다음 SQL 명령어를 복사한 후 콘솔에 넣어 실행한다. 

```sqlite
SELECT * FROM students WHERE id = 2;
```

위 명령어를 실행하면 다음과 같이 출력된다. 

![[Pasted image 20260111015251.png]]
여기서, `WHERE`은 데이터를 가져올 때 필터링을 적용하며, 여기서는 `id`가 2인 것만 필터링했다.


### 데이터 수정하기
---
이번에는 데이터를 수정하는 명령어로, `UPDATE`는 특정 데이터의 값을 수정하는 데 사용하며, 기본 문법은 아래와 같다. 

```sqlite
UPDATE 테이블_이름 SET 열_이름1 = 새로운값1, 열_이름2 = 새로운값2 WHERE 조건;
```


### 실습: 데이터 수정하기
---
`students` 테이블에 저장된 데이터를 수정하는 실습을 진행한다. `id`가 3인 학생의 이름을 `Nando Park`으로 수정할 것이다. 다음의 SQL 명령어를 복사해 콘솔에서 실행하면 된다. 

```sqlite
UPDATE students SET name = 'Nando Park' WHERE id = 3;
```

해당 명령어를 실행하면 다음과 같은 화면이 나온다. 

![[Pasted image 20260111022017.png]]
이제, 데이터가 수정되었는지 알아보려면 앞서 배운 `SELECT` 명령어를 사용해 `SELECT * FROM students;` 명령어를 입력해서 해당 데이터로 정상적으로 수정되었는지 확인할 수 있다. 

![[Pasted image 20260111022231.png]]
### 실습: 데이터 삭제하기
---
`students` 테이블에 저장된 `id`가 3인 학생 정보를 삭제하려면, 다음의 SQL 명령어를 복사한 후 SQLite 콘솔에 붙여 넣으면 된다. 

```sqlite
DELETE FROM students WHERE id = 3;
```

해당 명령어를 실행한 결과는 다음과 같다. 

![[Pasted image 20260111022432.png]]
이후, 데이터가 진짜 삭제되었는지 확인하려면, `SELECT` 명령어를 사용해 `SELECT * FROM students;` 명령어를 실행하면 된다. 

![[Pasted image 20260111022540.png]]
그러면 세 번째 학생의 정보가 삭제되어 출력되지 않는 모습을 확인할 수 있다. 


## 마치며
---
본 강의에서는 데이터베이스와 DBMS, 그리고 RDBMS인 SQLite와 그 명령어를 학습해 보았다. 데이터베이스의 SQL 명령어를 처음 접하거나 아직 익숙하지 않은 경우 복잡하고 어렵게 느껴질 수 있지만, 잘 이해하고 넘어가면 웹 해킹을 공부할 때 상당히 많은 도움이 될 것이다. 

현대 대부분의 웹 서비스는 데이터베이스를 탑재하고 있기 때문에 웹 서비스를 분석하고 취약점을 찾는 웹 해커로서 이런 역량을 강화하는 것이 필수적이다. 
