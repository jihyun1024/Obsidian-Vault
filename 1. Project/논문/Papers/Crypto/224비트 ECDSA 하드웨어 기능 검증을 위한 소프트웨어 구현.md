---
tags:
  - 논문
  - 암호학
link: https://www.dbpia.co.kr/journal/detail?nodeId=T13732828
category: Crypto
author: 김태훈
journal: 석사학위논문
---
## 1. 논문의 핵심 요약
---
타원곡선 암호를 사용한 전자서명으로는 ECDSA, EC-KCDSA 등이 있다. 이 중 ECDSA는 타원곡선 상에서 군(Group)을 정의하고 이에 대한 이산대수 문제의 어려움에 근거를 두고 있다. 

타원곡선 상에서의 이산대수 문제는 ECDLP(Elliptic Curve Discrete Logarithm Problem)라고 하며, [[양자보안]] 강의의 [[양자보안_5주차_월요일]] 수업에서 공부했던 것처럼, 일반적인 군에서 정의되는 이산대수 문제보다 더욱 어렵고, 동시에 작은 키로도 RSA보다 높은 비도를 유지할 수 있기 떄문에 많이 사용된다. 

이런 타원곡선 암호 알고리즘에는 다양한 방식이 있으며, 하드웨어적인 구조로는 직렬구조, 병렬구조, 파이프라인 구조 등이 있기 때문에 구현된 모듈이 제대로 동작하는지를 검증하는 것이 매우 중요하다. 이렇게 암호 모듈을 공식적으로 검증해주는 제도가 암호모듈 검증 프로그램인 CMVP (Cryptographic Module Validation Program) 이다. 

이를 위해 이 논문에서는 ECDSA 검증 과정에서 개발 단계에서 내부 모듈을 검증할 수 있는 하드웨어 맞춤형 검증 프로그램을 구현했다.


## 2. 연구 목적
---
CMVP에서의 ECDSA 검증과정은 키 생성 테스트, 공개키 검증 테스트, 서명 생성 테스트, 서명 검증 테스트로 구분되어 있다. 각각의 테스트는 모듈의 입출력 값과 검증 모듈의 출력을 비교해 이상 유무를 검증한다. 즉, 모듈의 검증이 실패할 때 어떤 내부 모듈이 잘못되었는가에 대한 피드백은 없다. 


## 3. 문제 정의
---
하드웨어 암호 모듈을 설계 후 검증까지 마치는 과정은 다음과 같다. 

1. 암호 모듈에 대한 하드웨어 구조 설계
2. 설계된 모듈 별로 개발자가 테스트벡터를 만들어 기능 검증 및 전체 모듈 구현
3. 구현된 암호 모듈을 공인 검증을 받기 위해 CMVP 시험기관에 의뢰
4. 시험기관에 암호 모듈의 입출력 검증
5. 하드웨어 설계 구조와 같은 구조로 소프트웨어를 구현하고 각 하드웨어 부 모듈의 개발 및 검증 단계에서 테스트벡터를 제공

이를 위해, 본 논문에서는 ECDSA 검증 과정에서 서명 생성 및 서명 검증 뿐만 아니라, 개발 단계에서 내부 모듈을 검증할 수 있는 **하드웨어 맞춤형 검증 프로그램**을 구현했다. 

ECDSA 하드웨어 모듈 검증용 소프트웨어는 **키 길이가 224비트인 ECDSA**를 토대로 224비트의 유한체 사칙연산, 스칼라 곱셈, 타원곡선 전자서명까지의 내부 모듈 검증 기능을 개발했다. 

(참고할 내 Github 페이지: https://github.com/jihyun1024/Elliptic_Curve_Crypto)


## 4. 타원곡선 암호 알고리즘
---
### 공개키 암호 시스템
RSA는 다양한 분야에서 사용되었으나, 많은 양의 연산량이 필요하다. 이에 따라, 타원곡선 알고리즘은 RSA 암호에 비해 빠른 속도와 적은 양의 메모리 필요량, 낮은 비용, 무선 통신 가능 등의 이점으로 강력한 암호 기술로 평가된다. 

타원곡선 암호는 유한체 상의 타원 곡선이 유한군을 가지며 그 위에서 이산대수 문제가 정의될 수 있음에 착안해 제시된 암호 알고리즘으로, 쉽게 말하면, 한 공간 안에서 여러 개를 일정한 규칙으로 잡아와 한 공간 안에 들여보냈더니 우연히 그것들이 수학적으로 잘 연결되어 있어 암호에 사용될 수 있다는 것이다. 

![[Pasted image 20260214232932.png]]
(대충 이런 이미지로, 이 이미지의 문제 또한 타원곡선으로 풀 수 있다!)

타원곡선 암호는 계산량, 키 크기 및 대역폭의 관점에서 다른 공개키 암호 시스템보다 더 효율적으로, 구현에 있어서 이런 장점은 꽤 크게 작용한다.

### 타원곡선 암호시스템 구현을 위한 기초 지식
여기서는 타원곡선(Elliptic Curve)을 암호화에 적용하는 방법에 대한 배경지식을 설명한다. 

**1. Prime Finite Field**
소수 유한체에 대한 내용을 본문에서 요약하면 다음과 같다. 유한체(finite field)는 원소의 개수가 유한개인 체(field)를 말하며, 체는 **0으로 나누는 것을 제외한 덧셈, 곱셈 (역원과의 연산은 각각 뺄셈, 나눗셈)을 자유롭게 할 수 있는 집합**을 의미한다. 

집합 $F$ 위에 덧셈 $+$과 곱셈 $*$이 정의되어 있고, 다음이 성립할 때 $F$를 체라 한다. 

- $(F, *)$ 는 Abelian Group이다. 
- 곱셈 $*$에 대해 결합법칙이 성립한다.
- 분배법칙이 성립한다.

$p$를 소수라고 할 때 소수체 $GF(p)$의 원소들 사이의 연산은 $p$를 법($mod$)으로 하는 모듈로 연산으로, 임의의 원소 $\alpha, \beta \in GF(p)$에 대해 덧셈과 곱셈은 다음과 같이 정의한다. 

- 덧셈: $\alpha + \beta = (\alpha + \beta)\ mod\ p$
- 곱셈: $\alpha * \beta = (\alpha * \beta) \ mod\ p$

(역원은 Extended Euclidean Algorithm에 의해 계산된다)
NIST에서 발표한 FIPS 186-2에서는 5개의 prime field를 통해 타원곡선의 표준을 권장한다. 

![[Pasted image 20260214234223.png]]

이런 소수는 2의 제곱수의 합 또는 차로 쓸 수 있는 특성을 가지며, $p_{521}$을 제외하면 지수승이 32의 배수로, 이런 속성은 워드의 크기가 32인 기계에서 빠르기 때문에 효율적이다. 

**2. 타원곡선 스칼라 곱셈**
체 $K$ 위에 정의한 타원곡선을 $E$라고 하자. $E(K)$에서 타원곡선의 두 점의 덧셈을 기하학적으로 설명하면 **$P = (x_1, y_1)$ 이고 $Q=(x_2, y_2)$일 때 $P$와 $Q$를 이은 직선과 타원곡선과의 교점의 $x$축 대칭인 점**이라고 서술할 수 있다. 

이어서 $P$의 두 배 연산을 기하학적으로 설명하면 **$P$에서 타원곡선에 그은 접선과 타원곡선과의 교점의 $x$축 대칭인 점**으로 서술할 수 있다. 

![[Pasted image 20260214234716.png|350x350]]![[Pasted image 20260214234920.png|350x350]]

여기서 대수학적 공식의 군의 법칙도 기하학적 설명으로 도출될 수 있는데, Weierstrass 형태의 타원곡선 $E$는 체 $K$의 특징이 2 또는 3이 아닌 경우이다. (서술하기 귀찮으니 사진으로 대체한다)

![[Pasted image 20260214235546.png]]

따라서, 타원곡선 위의 두 점의 덧셈과 한 점의 두 배는 두 유한체 원소의 뺄셈, 한 유한체 원소의 역원, 두 유한체 원소의 곱셈, 한 유한체 원소의 제곱으로 구할 수 있다. 

또한, 타원곡선의 스칼라 곱셈은 2배 연산과 덧셈을 반복하면 구할 수 있다. 

**3. ECDSA 지원 해시함수**
해시함수는 임의의 길이를 가진 입력 메시지를 고정된 길이의 출력으로 압축하는 함수로, 해시함수가 되기 위해서는 다음의 두 가지 조건을 만족해야 한다. 

- 일방향성(One-Way): 해시값 $y$에 대해 $y = h(x)$를 만족하는 $x$를 역으로 찾는 것이 불가능하다.
- 충돌 회피(Collision-Free): 입력 $x$에 대해 동일한 출력 $y$를 갖는 입력 $x'$을 찾는 것이 불가하다.

일반적으로 널리 쓰이는 해시함수로는 MD5, SHA1, SHA-224, RMD160, Tiger 등이 있고, SHA-383, SHA-512를 제외하고는 입력을 512비트 블록 단위로 처리하며, 마지막 블록의 패딩 규칙도 매우 비슷하다. 

이 중 SHA-224는 미국 NIST의 NSA에 의해 개발된 MD5와 비슷한 구조로, MD5와는 달리 224비트의 출력을 가지고, 512비트 입력에 대해 64번의 단계 연산을 수행한다. 64개의 메시지 워드를 생성할 때 처음 15개는 512비트 입력 메시지를 그대로 입력하고 그 다음부터는  $W^t = \sigma_1(W^{t-2}) + (W^{t-7}) + \sigma_0(W^{t-15}) + (W^{t-16}) \ (16 \leq t \leq 63)$ 과 같은 연산을 수행한다. 

이러한 연산의 메인 루프의 연산과정은 다음과 같다. 

![[Pasted image 20260215001244.png]]

따라서, 앞서 설명한 연산을 토대로 SHA-224의 연산 구조는 다음과 같다. 

![[Pasted image 20260215001312.png]]

### 타원곡선 전자서명 (ECDSA)
서명 과정을 살펴보자. 타원곡선 전자서명은 $n$을 타원곡선 군의 위수(몇 번 제곱해야 1이 나오는지)라고 할 때 메시지 $m$에 대한 서명과 검증이 다음과 같이 이루어진다. 

[[양자보안_6주차_수요일]]의 [[양자보안_6주차_수요일#ECDSA(Elliptic Curve Digital Signature Algorithm)|ECDSA (Elliptic Curve Digital Signature)]] 부분을 참고해서 보면 된다. 
서술 형태는 조금 가독성이 ㅈ같긴 해도, 알고리즘이 그대로 써져 있으니 이해는 될 것이다. 

(참고로, 서명 생성 과정과 검증 과정의 해시 함수의 경우, SHA-224와 SHA-256 등을 권장한다)

### ECDSA 하드웨어 구현 검증의 필요성
ECDSA는 앞서서 설명한 것처럼 타원곡선 알고리즘의 효율성으로 인해 유한체 위에서의 타원 곡선을 하드웨어적으로 구현하기 위한 노력이 이루어지고 있다. 그러나, 그에 대한 다양한 하드웨어 구조가 제안되기 때문에 구현된 모듈이 제대로 동작하는지에 대한 평가가 매우 중요하다. 

NIST에서 제안한 암호 알고리즘을 검증하는 방법은 아래 3가지로 나뉜다. 

- Known Answer Test
	- 일정 패턴의 값을 입력 값으로 설정
	- 전체 암호 알고리즘의 검증과 암호 알고리즘의 하위 모듈의 테스트에서 사용
	- 평문 고정, 키 값을 일정한 규칙으로 변화하며 테스트
	- 키 고정, 평문 값을 일정한 규칙으로 변화하며 테스트
- Modes Test
	- Monte-Carlo Test의 근간이 되는 테스트 방법
	- 랜덤 설정된 입력 값을 입력하여 10000번 반복하는 동안 입력 값은 전의 결과를 입력
	- 10000번 반복한 결과를 비교
		- 새로운 랜덤 값을 입력하여 다시 위의 과정을 400번 반복
- Monte-Carlo Test
	- 난수발생기를 사용해 생성된 테스트 벡터에 대해 출력과 예상 출력에 대한 비교
	- 하나의 테스트 벡터를 입력으로 해 생성된 출력을 새로운 입력으로 사용
		- 각 알고리즘 검증 과정에 제시된 횟수만큼 반복
	- 임의의 값을 사용함으로 Known Answer Test에서 발견하지 못한 오류를 찾는 방법

기존 ECDSA 검증시스템(Elliptic Curve Digital Signature Algorithm Validation System, 이하 ECDSAVS)은 키 생성 테스트, 공개키 검증 테스트, 서명 생성 테스트, 서명 검증 테스트 검사를 수행하며, FIPS 186-3에서 정의된 타원곡선을 검증대상으로 한다. 

각각은 다음 그림과 같다. 

![[Pasted image 20260215003918.png]]

![[Pasted image 20260215003928.png]]

![[Pasted image 20260215003938.png]]

![[Pasted image 20260215003949.png]]

이 4가지의 검증 테스트와 같이 CMVP는 모듈 전체에 대한 입출력 값까지 검증하므로 검증이 실패하면 어떤 내부 모듈이 잘못되었는지에 대한 피드백은 없다. 

이런 문제점을 개선하기 위해서는 타원곡선 암호의 구현에 필요한 내부 모듈의 검증 과정이 필요하다. 따라서 **ECDSA의 내부 모듈인 유한체의 사칙연산 모듈부터 스칼라 곱셈 모듈, ECDSA 서명 생성 및 검증 모듈까지 기능 검증을 할 수 있는 검증 소프트웨어**를 개발했다.


## 5. 검증 소프트웨어 설계
---
### 목표 ECDSA 파라미터

### 목표 하드웨어 기본 구조

### ECDSA 하드웨어 맞춤형 소프트웨어 설계 및 구현

## 6. ECDSA 하드웨어 내부 모듈 검증
---
### 하드웨어 검증 방법

### 유한체 사칙연산 모듈 검증

### 스칼라 곱셈 모듈 검증

### 타원곡선 점 연산 모듈 검증

### SHA-1 모듈 검증

### ECDSA 서명 모듈 검증

### ECDSA 검증 모듈 검증


## 7. 결론 및 한계
---
이 논문에서는 ECDSA를 하위 모듈에서 상위 모듈까지 전체적으로 검증을 하기 위한 프로그램을 개발했다. 이 프로그램에는 타원곡선 전자서명의 하위 모듈인 유한체 사칙연산 모듈이 존재하며, 이런 유한체 사칙연산 모듈을 통해 상위 모듈인 타원곡선 위에서의 점 연산 모듈을 구현할 수 있으며, 이 연산들을 사용해 스칼라 곱셈이 가능하다. 또한, 상위 모듈인 타원곡선 전자서명의 서명 생성 및 서명 검증 모듈의 테스트벡터도 제공하고 있다. 

이 프로그램은 전체 내부 모듈의 테스트벡터를 제공하기 때문에 암호 모듈 개발자가 개발 과정에서 모든 내부 모듈을 점검할 수 있다. **개발 과정에서 내부 모듈을 점검할 수 있으므로, 개발의 속도 향상 또한 기대할 수 있을 것이다.**

그러나, 224비트 ECDSA 내부 모듈의 테스트벡터만을 제공하기 때문에 더 강력한 보안을 제공하는 256비트, 384비트 ECDSA 내부 모듈의 테스트벡터를 제공하는 소프트웨어도 필요하다.


## 8. 더 공부할 내용
---
암호 모듈 검증 방법들에 대해서 공식 문서 및 관련 논문들을 보면서 더 공부해야 할 것 같다. 

또한, ECDSA의 기본 구조에 대해서는 [[양자보안]] 수업에서 공부했으니, 그것도 보고, 3학년 1학기에 공부했던 고급암호학 및 실습 수업에서 다뤘던 Elliptic Curve에 대한 개념도 Guide to Elliptic Curve Cryptography 책을 보면서 더 공부가 필요할 것 같다. 

필요하다면, Cryptography 폴더에 배경 지식을 정리할 필요가 있다. 

## 9. 비슷한 논문 / 선행 or 후속 연구
---
**관련 Obsidian 문서**
- [[양자보안]]
	- [[양자보안_4주차_월요일]]: DSA의 키 길이 관련 서술
	- [[양자보안_6주차_월요일]], [[양자보안_6주차_수요일]]: ECDH, ECDSA 관련 서술

**선행 연구**
- 목포대학교 산학협력단. (2013.05.23). 몽고메리 역원 알고리즘을 위한 뺄셈 연산 장치 및 그 방법. 특허등록(10-1321259)
- 서창호 · 홍도원 · 윤보현 · 김석우 · 이옥연 · 정교일. (2004). 정보보안: 무선 환경에 적합한 타원곡선 암호 알고리즘의 검증도구. 정보처리학회논문지 C, 11(5), 569-576.
- [[타원곡선 암호의 최적화 구현, 부채널 대응기법 동향분석 및 벤치마킹]]