[함수 프롤로그(prolog) / 함수 에필로그(eplilog)](https://jiravvit.tistory.com/entry/%ED%95%A8%EC%88%98-%ED%94%84%EB%A1%A4%EB%A1%9C%EA%B7%B8prolog-%ED%95%A8%EC%88%98-%EC%97%90%ED%95%84%EB%A1%9C%EA%B7%B8eplilog)
우선 함수 프롤로그와 에필로그에 대해 알아보기 전에 스택 프레임에 대해 알아야 한다. 
### 스택 프레임이란?
[[세그먼트]]를 구성하는 스택 세그먼트 내부의 단위를 스택 프레임(Stack frame)이라고 한다. 이 스택 프레임은 함수가 호출될 때 생성되고, 함수가 반환될 때 해제된다. 
즉, 그 함수만의 스택 영역을 구분하기 위해 생성되는 함수 자기 자신만이 갖는 공간을 뜻한다. 
이 스택 프레임 영역을 할당하기 위해 함수 프롤로그와 함수 에필로그가 수행된다. 
### 함수 내에서 다른 함수 호출을 위해 필요한 일
1. 돌아갈 위치를 스택에 push한다. 
2. 이전 함수의 스택 base addr을 스택에 push한다. 

함수 수행을 마치고 호출 위치로 돌아갈 준비를 위해 스택을 다시 복원한다. 
1. 함수를 종료한다. 
2. 스택 base pointer를 이전 함수의 스택 base addr로 재설정한다. 
3. 호출한 함수로 돌아간다. 
![[Pasted image 20250806131321.png]]

### 함수 프롤로그
* `push ebp`: 되돌아갈 함수의 base pointer를 스택에 push한다.
* `mov ebp, esp`: 현재 함수의 스택 base를 설정한다.
이 과정을 함수 프롤로그라고 하며, 그림으로 표현하면 다음과 같다.
![[Pasted image 20250806134849.png]]
1번의 과정으로 SFP가 스택에 push되고, 2번의 과정으로 EBP와 ESP가 같아진다. 이제 스택에 `callee`의 변수가 들어오게 되면 ESP의 값이 음수가 되어 `callee`의 스택 프레임이 커지게 된다. 
### 함수 에필로그
함수의 수행을 다 마치고 나서 처음 호출한 지점으로 돌아가기 위해 스택을 복원하는 과정으로, 함수 프롤로그와 반대 과정으로 이루어진다. 
- `leave`
	- `mov esp, ebp`
	- `pop ebp`: 스택의 최상위에서 4byte를 복사하여 EBP에 담고 ESP의 값을 ESP+4로 바꿔준다.
- `ret`
	- `pop eip`: 스택의 `RET`을 EIP로 pop한다.
	- `jmp eip`
