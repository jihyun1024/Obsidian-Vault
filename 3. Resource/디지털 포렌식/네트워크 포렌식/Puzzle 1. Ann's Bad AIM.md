https://forensicscontest.com/2009/09/25/puzzle-1-anns-bad-aim

- [[#문제 해석 (DeepL)|문제 해석 (DeepL)]]
- [[#문제 풀이|문제 풀이]]
- [[#문제 정답|문제 정답]]
- [[#소감|소감]]

### 문제 해석 (DeepL)
Anarchy-R-Us 회사는 직원 중 한 명인 앤 더커버가 경쟁사에서 일하는 비밀 요원이라고 의심합니다. 앤은 회사의 핵심 자산인 비밀 레시피에 접근할 수 있습니다. 보안 직원들은 앤이 회사의 비밀 레시피를 유출하려 할까봐 우려하고 있습니다.
보안 직원들이 한동안 앤의 활동을 감시해 왔지만, 지금까지는 의심스러운 점을 발견하지 못했습니다. 오늘 회사 무선 네트워크에 예상치 못한 노트북이 잠시 나타났습니다. 건물 내에 낯선 사람이 보이지 않았기 때문에 직원들은 주차장에 있던 누군가의 짓이었을 가능성이 있다고 추측합니다. 앤의 컴퓨터( **192.168.1.158** )는 무선 네트워크를 통해 이 컴퓨터로 인스턴트 메시지를 전송했습니다. 노트북은 그 직후 사라졌습니다.
["활동에 대한 패킷을 캡처](https://forensicscontest.com/contest01/evidence01.pcap) 했습니다 ." 보안 직원이 말했다. "하지만 무슨 일이 일어나고 있는지 파악할 수 없습니다. 도와주시겠습니까?"
당신은 법의학 수사관입니다. 당신의 임무는 앤이 누구와 무엇을 보냈는지 파악하고, 다음과 같은 증거를 확보하는 것입니다.

1. Ann의 메신저 친구 이름은 무엇입니까?  
2. 캡처된 메신저 대화의 첫 번째 댓글은 무엇입니까?  
3. Ann이 전송한 파일 이름은 무엇입니까?  
4. 추출하려는 파일의 매직 넘버(처음 4바이트)는 무엇입니까?  
5. 파일의 MD5sum은 무엇입니까?  
6. 비밀 레시피는 무엇입니까?

[증거 파일은](https://forensicscontest.com/contest01/evidence01.pcap) 다음과 같습니다 .
[http://forensicscontest.com/contest01/evidence01.pcap](https://forensicscontest.com/contest01/evidence01.pcap)  
MD5(evidence.pcap) = d187d77e18c84f6d72f5845edca833f5

### 문제 풀이
먼저 첨부된 .pcap 파일을 [[WireShark]] 도구로 열어주고, 192.168.1.158로 필터링한다. 
그러면, 해당 IP 주소에서 주거나 받은 것들만 볼 수 있다. 
![[Pasted image 20250812011605.png]]

해당 항목을 전부 다 검사하기는 힘드니, `마우스 오른쪽 클릭 - 따라가기 - TCP 스트림` 으로 [[TCP]] 스트림에 대해 확인할 수 있다. 
스트림을 보면 여러 질문들에 대한 값을 어느 정도 유추해 볼 수 있었다. 
![[Pasted image 20250812014353.png]]
![[Pasted image 20250812014440.png]]
해당 사진에서 여러 의미 있는 문자열을 찾아 볼 수 있었지만, 그냥 추측일 뿐이기 때문에
`분석 - 다른 형식으로 디코드`를 눌러 다음과 같이 설정을 저장하고 `확인`을 누른다. 
(아마 문제의 제목부터가 `AIM` 프로토콜을 쓰라는 힌트가 아니었을까?)
![[Pasted image 20250812014934.png]]

설정이 다 되었다면 천천히 분석해 보자. 
먼저, `통계 - 플로 그래프`를 보면, 다음과 같이 Ann이 64.12.24.50과만 통신하는 것이 확인된다. 
![[Pasted image 20250812015155.png]]
그러면, 이게 누구일까...? 
누구인지는 25번 패킷에서 확인할 수 있다. 25번 패킷의 `Info`를 보면 `AIM Messaging, Outgoing to: Sec558user1`이라는, 누가 봐도 수신자를 나타낸 것처럼 보이는 정보가 있으며, 더 자세히 분석하기 위해 밑의 세부 정보를 확인하면, 더 자세하게 Buddy(친구)에 `Sec558user1`이 있으며, 메시지의 첫 번째 comment 또한 확인할 수 있다. 
![[Pasted image 20250812015742.png]]

---
다시 TCP 스트림 따라가기로 돌아와서, 스트림을 계속 보다 보면 3번 문제인 Ann이 전송한 파일의 이름 또한 `recipe.docx`인 것을 알 수 있으며, 이 파일이 비밀 레시피라는 것을 유추할 수 있다. 
![[Pasted image 20250812020111.png]]
또한, 추출할 파일의 매직 넘버, 즉 파일 시그니처는 `.docx`의 파일 시그니처인 `50 4B 03 04`이다. 

--- 
5번, 6번 문제를 풀기 위해서는 먼저 `recipe.docx`파일을 파싱해야 한다. 
`recipe.docx`파일을 파싱하기 위해서 `tcp.stream eq 5`를 검색하고 하나씩 내리다 보면 다음과 같이 `recipe.docx`라고 끝에 써져 있는 부분을 발견할 수 있으며, 
그 다음에 파일이 나오겠구나 라는 것을 추측할 수 있다. 
따라서, 다시 TCP 스트림을 확인하면, 다음처럼 `recipe.docx`뒤에 `PK`시그니처로 시작하는 파일이 있는 것을 확인할 수 있다. 
![[Pasted image 20250812024450.png]]
**단, TCP 스트림을 확인할 때 `tcp.stream eq 2`인 상태면 안 보인다.
나도 그 문제 때문에 꽤 오랜 시간이 걸렸다.....**

아래의 `다른 형식으로 표시`를 `Raw`로 바꾸어 주고, 파일 시그니처부터 빨간색 부분 이전까지 복사한다. 
이후 Hex Editor에 그대로 붙여넣기 하고 `recipe.docx`로 저장한다. 
![[Pasted image 20250812024706.png]]그러면, 다음처럼 정상적으로 파일이 보인다. 
![[Pasted image 20250812025004.png]]

다시 5번 문제로 돌아가서, 파일의 MD5 체크섬을 구해보자. 
MD5 체크섬은 HxD에서 `분석 - 체크섬`에서 구할 수 있으며, 이를 계산한 결과는 아래와 같다. 
![[Pasted image 20250812025151.png]]

### 문제 정답
1. Ann의 메신저 친구 이름은 무엇입니까?
	- Sec558user1
2. 캡처된 메신저 대화의 첫 번째 댓글은 무엇입니까?  
	- Here's the secret recipe... I just downloaded it from the file server. Just copy to a thumb drive and you're good to go
3. Ann이 전송한 파일 이름은 무엇입니까?  
	- recipe.docx
4. 추출하려는 파일의 매직 넘버(처음 4바이트)는 무엇입니까?  
	- `50 4B 03 04`
5. 파일의 MD5sum은 무엇입니까?  
	- `8350582774E1D4DBE1D61D64C89E0EA1`
6. 비밀 레시피는 무엇입니까?
	- 다음 사진과 같다. ![[Pasted image 20250812025727.png]]

### 소감
1. Network Miner라는 툴을 이용하면 더 쉽게 풀 수 있다. 기회가 된다면 그거로도 풀어보고 싶다.
2. WireShark의 명령어나 단축키 등에 대해 더 많이 공부해 봐야겠다.
3. `tcp.stream eq` 명령어가 뭐 하는 역할일까?
4. 난 말하는 감자인 것 같다.... 네트워크, 리버스 엔지니어링 공부를 더 열심히 하자.