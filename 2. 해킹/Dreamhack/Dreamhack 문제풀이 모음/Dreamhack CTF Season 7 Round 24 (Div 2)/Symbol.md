---
tags:
  - 암호학
  - Dreamhack
created: 2025-12-27
---
## 문제 정보
---
- File: `prob.py`
- Token size: 64 비트
- Goal: Token 복구


## 문제 요약
---
이 문제는 정수론의 **Legendre symbol (르장드르 기호)** 라는 개념을 바탕으로 출제된 문제이며, **Quadratic residue (제곱 잉여)** 라는 개념과도 연관이 되어 있다. 

이 문제에서는 `prob.py` 코드를 실행하면 `p = `라는 문자 뒤에 512비트의 소수가 나오며, 그 뒤로 64개의 어떤 숫자 문자열이 추가로 나오고, 그 뒤로 입력을 받아 입력이 정답과 같다면 플래그를 받을 수 있다. 

- [Legendre symbol](https://ko.wikipedia.org/wiki/%EB%A5%B4%EC%9E%A5%EB%93%9C%EB%A5%B4_%EA%B8%B0%ED%98%B8)
- [Quadratic residue](https://ko.wikipedia.org/wiki/%EC%A0%9C%EA%B3%B1_%EC%9E%89%EC%97%AC)


## 문제 풀이 및 설명
---
문제 코드는 다음과 같다. 

```python
#!/usr/bin/env python3
from os import urandom
from random import randrange
from Cryptodome.Util.number import getPrime

BITS = 64
token = urandom(BITS//8)
token = int.from_bytes(token,"big")

p = getPrime(512)
while p%4 == 1:
    p = getPrime(512)
print(f"{p = }")

for i in range(BITS):
    bit = (token>>i)&1
    k = randrange(2,p-1)**2%p
    if bit:
        k = -k%p
    print(k)
  
answer = int(input("> "))
if answer == token:
    print(open("flag","r").read())
else:
    print("Wrong!")
```

코드를 보면 각 비트는 다음의 방식대로 인코딩된다. 

```python
k = randrange(2, p-1) ** 2 % p
if bit:
	k = -k % p
```

즉, `bit == 0`일 경우에는 $k ≡ x^2\ (mod\ p)$이며, `bit == 1`일 경우에는 $k ≡ -x^2\ (mod\ p)$가 된다. 이는 Quadratic residue와 Non-quadratic residue 판별 문제와 동일하다. 

그렇다면, 어떻게 다시 64개의 비트를 복구해서 Token을 찾을 수 있을까? 여기에서도 정수론이 활용된다. 바로 **Euler's Criterion (Euler 판별법)** 에 의한 것으로, Euler's Criterion에 의하면, 

![[Pasted image 20251227213135.png]]
이 성립한다.

따라서, Quadratic residue에 해당하는 것과 아닌 것은 각각 비트를 다르게 설정하도록 프로그래밍 하면 된다.


## 공격 전략
---
코드는 다음과 같은 순서대로 프로그래밍할 수 있다. 

1. 공개된 소수 $p$ 획득
2. 출력된 64개의 값 $k_i$ 수집
3. 각 $k_i$, 즉 각 수에 대해서 Euler's Criterion 계산
4. 결과가 1이면 비트는 0으로, 결과가 $p-1$이면 비트는 1로 설정
5. 비트들을 조합해 Token 복구
6. 복구한 Token을 출력


## 코드
---
```python
# recover_token.py

def recover_token(p, ks):
    token = 0
    for i, k in enumerate(ks):
        # Legendre symbol 계산
        leg = pow(k, (p - 1) // 2, p)

        if leg == p - 1:  # non-residue → bit = 1
            token |= (1 << i)
        elif leg == 1:    # residue → bit = 0
            pass
        else:
            raise ValueError("Invalid Legendre symbol")
  
    return token
  
# ===== 사용 예시 =====
# 문제에서 출력된 p
p = 8947695157607072140971698418181308001500374588392348069316678876511307754529810157520770355272514358168121600895079136304429697133624773912040213749273563  # 실제 출력된 p 값

# 문제에서 순서대로 출력된 64개의 k
ks = [

6635340678094312857803173502076354918521966974873681283346407034584965682816636970185962834148590683390833537561978257323165443201112575619476738199505322,

7408901577251294284037558002957554122636686883957567961464313384970612790756318750823705666270121954511461930482295066227485861034280003784507615518148488,

4270566677404254308619883941896277501573551674601294863863119359742878567825985848556354310243284419585549498800448030042253949855169432745052784180566153,

4967050369959719727060301881174247402244280301147741810996547055020653825304216606602477546976484568034951165738924442985393484639917301904863813627860605,

7598304910016175580179134728180422462130105577618488501590215676594300986397291433446173625236313363967600623973543755518586469481016405766603467368242264,

2517016264420697657712855611073542633461041895072933193940866677150028387578513949601583989377455094046724191107550495823836043783497819529033213600159262,

4457110067561736752530531206621266094884164324571619279513954505426751631642801270807592401871256009705803868114905227260427579212551750342031053033571298,

2462597363068510690133305734179761862786760021907733594741091709274310897960509807908770914976044178469208565052796878952335132021658259676085595393634338,

8465329795301137350192428816874916346998748776089505120812852582800973337329418984302162276050001634142035515324320774906189175442579596291912241237539152,

8199314039863522974674888698175203649272187226437751980618412732096436422029951037511871418421390786461754453865395332162809742750288413639020905087604170,

5535207628210884448052146480974656733332168959329039106705646160629273790219352674178867328337883414420303006753494592602246264041503666550256167237060740,

3393503858526340046203839699564829126162887114011788656787447173931476242855039674572413925528162322025864300881585986492537605038048391985445333906855546,

7334281407181276820506979784543508283334273033456753173368677314754902336515702893876518348640465061637656788616564358590863438712981940742656062653398322,

730057693594740417936934267829168735244639140331202701873619901410619300640499157410893445512742277791366394454711793773262784941399746573131066059898304,

6530776305999326838215536189881579533008476354707412318025442309318524993769994223041099146769727031471651275922993499692953909454013631831852529154141914,

8707292664783583619076906714066573042728673206790286100953487967636770277068284770136668081021954945854789639376292240101456872487875054904365221398040312,

242992791504825387492403678326650319972244116899924843193488591496215615413284623472363887630698132072471436625646299944055832584552755406867338816210804,

7031634942996532038531189152633565255168734787638219531448394007266502049149972649353866142719854402640032563598003690034736996365867355945238150913473918,

7613004016767813483504375774437339940399137082073611846120750747188027996901187816002396980440798986697844475353730631059321238248352296677962851660567983,

5078833003788343718979630479094541274040210780887043885932754082041710054556420655413599235028735776941462069966032324432754307390239237341093080779553747,

3507879515271413963495331563841276440336688567307293871572954305793850696982264432744075280017876769497136047300082287281581380944116892534610313496005056,

6089227336418671118703809462689718931801947673945627296622391957743988216845819366101330904990153096900617626109223876579021008205336872343764284733698224,

8763796110760409429292888216008817166883424660717161686387534592647573550501149151124802277024306356650898782634674271036381663211142737794635448818049188,

367139621751149966475830264137498739638909983199850556460598868499735949390472562931063371593795476070508974374213933883118472573462280255851535087849510,

7439700013637527837505574057197483377371557721359461351254086690248073457069028778758791579138914790055827991344656982480222762895073671826759832964019372,

6594390719807143131983737998165061014053235074021134317035142189158657538600103431208584315276562613374619671468708033495772087916874186279975979111469280,

7966283359083901639517866400800379788063896236217025237300386554397827326589718299656085331258376295954000156441836069116944841091519726073367273602679477,

4600653550954010857966426528925401425403396113856082712157007251688443705920660636482928707594779789527262806534764494407820239933975216059217209266593942,

5278271955060066135372852156887594763971694900045749001773275882479108946488077669133583699095490403293082608078348477075258265299658034223113466294296796,

6861016402091745920456461928856353866380615226992328016438391687812147026059536185343252348486183631929377165147089942385041412595434730048349877994881700,

5134309335158440551857449710654597306156798154530813653181513835938146049147435596126297565938743923086291193570148523407194781768421733876852568645713584,

426859476366660253228670725089244906482952596166507749053819970007234168647771061764478041165862162595816082224557441572217934678207360481641821356480477,

4764242064904883395082902791391383255470507431653276807604497900403954744839625574545194989946596979040424141105020742903665955438044669629743318144973377,

4999358161789580840687291196265722025709318331566712559319184268985899059879208446181534063690731005597013030875270973874816089535637108083181243384694964,

3286636912622297816108193037159478160967222153984572364944216338254387670071789065088440033007498053098449633011658948322390525691202313910096046271868899,

729896696491205880842596553064440079409347667234189198734778262577187758567486007847562634120717625006170778776095188231713389640869521218983577586817379,

7070812234360009541870550690505717814983923178461163643443769733390524443437666501129612553751473411802994527218241637506812247812295075647140101353705634,

5456990178611518328460608348853825856489518746676848250904777783300334642629156860022361080978931526854182506953970785519292582537046014524984510610434848,

3950960321191349132323219288810696006173606785828995301707490209124368360799523566905728857837679793681239733039680019985916616324289639171398415718117845,

3808423049829096699694866474309156187194808527148460809620330949012648260346135278722066947078731186708236759232144189805003727972614799359660501536179143,

6906236135753518762987649511657147508633490452245073770625902543556786608163358464862666717299375404916788046827242083225335575655896728189597379589168967,

5333165548861798912850794818962551249198250498815993582553412816512891747798373525356298940917748260556639137580345434323615747210191897903530147840735371,

949864094105735403183178982961887786530986782999412992689649968167350778681620157592251913401432555359066291951428846179505468843672146643999113220768327,

2139555254146697859498738599483020079816117363602243119316481494456210746457028325455426396763865008339070088013493253001493549789074530712875936725386675,

5337920677969660746783037846907383956215469283702178753828224816633058271484734226518054062386857398616707825849702903377145009714148548833903617500654398,

714615607443250108149279149050277749216844495464030500627471265342404048487789296084691563656791585065448558810595942205820858180368945293233678645732261,

5945619191174235789291418754121566105803079204501827387467196126866833998330358899109175988094972587228215954298508407276909678157335465183604292436108905,

1174429226278829003500290164179113947606071434656848322456822472785233977843970913262629420884086237768610376540532508171345755186033155649215927530194800,

3395378472001182025655089723752439748996885975614238462678652298395300211401927054023655795305671859763945881583106193928480514492670892745725414705301612,

4600767457890278905720379138642145282103599762164911975301739319069248790649112018683462313479336548540681468071557013080348063649291793799154150932503754,

7407575775494101155168184834033913098297667168859652700266169586081122887893292830793633804623010567731172556594214635131048480704125517071859896658368417,

6379690828918753531592583792253064818251361894688791435097462638705324022763720460589728394926467811714133082902458429065115730169624462881508444069933404,

8420580380867518711576310218263086734605293174355368414895654848236090346312799324742624118638174341254033870927548778614052137628493226106860647716640499,

6453361197660122362358563905915334316555431820277658797734769184630025628673819074673293686174277896801970064115281660361738161033838192961520620037202860,

875319757018706770692833958946344623824799105812281820103104705820546284864477154125662991077480302592731274392235670481558889835048295259665100208589617,

7031572713839326236275727914411492425630958884296622754985598569246430119962275084741459604076689510057466527446579066719915687557267138713173960999098057,

4580311269905527144980692153456069089837594878270877806151791319054763666053871536786350821936133756567602388808184845241926452641563130430353770165749079,

8637460959107877989971511214919586312979827815706056001723059223335628823425851433544903425400298455859084703875291272664647180331611711734058458782690959,

4030988614811901449686017766618203052435695223047359595869576075406012313193796190922586779973555673467442151842993076124985851233073390884006590943025522,

1756870385150032778779679839093080376352882930681807344806171781025900271103852459545478102242287693393444461059698157404001000784981902077599217769579820,

3104684474788234935637444645774201854550362017636346161433933162202098073812911292920608899234321927442684234574703067133925566600413513045396749365746089,

28295857417550671096418940882923994591980695737093969143366272249592922725743441458558154863553402308740855055924577797343635126077704836826702788732920,

8306810191126209544205979702224440293284674847839379232167817546125576014982849139889289285001742253521821708448477702786840986889841900838962166377453602,

4054532139317931552858475599818975231019960015562075546837633938670030765568773007871751936928332444692963070531667207835684916165666943546376735903725116]

  
token = recover_token(p, ks)
print("Recovered token:", token)
```


## 결과
---
`DH{legendary_legendre_symbol:RRaaTYM6XczijVTsryDL9g==}`


## 배운 점 & 복습 포인트
---
- **Quadratic residue**를 했다고 해서 안전하지 않다
- **Euler's Criterion**이 이 문제에서 핵심적인 역할을 했다
- 암호학 문제를 만나더라도, 수학적인 원리만 알고 있다면 해결할 수 있으며, 오히려 더 쉽다.
- 정수론, 선형대수학, 현대대수학 등 기초적인 과목이 매우 중요하다.


---
>[!example] Write-up이란
>Write-up은 “내가 푼 기록”이 아니라  
“다음에 같은 문제를 5분 만에 풀기 위한 문서”다.
