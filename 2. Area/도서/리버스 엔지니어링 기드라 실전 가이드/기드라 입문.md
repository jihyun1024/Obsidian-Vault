---
tags:
---
# 기드라란 
* 미국 국가안보국(NSA)에서 개발한 소프트웨어 리버스 엔지니어링 도구
* [Github](https://github.com/NationalSecurityAgency/ghidra)에서 소스코드 배포 중
* 세계 최대 정보보안 컨퍼런스인 Black Hat USA 2019에서도 발표
* Windows, Mac OS, Linux 등 환경에 상관없이 동작
* 주요 기능으로 디스어셈블, 디컴파일, 헤더나 라이브러리 등 표시, 스크립트 분석 등

# 설치
- 기드라가 지원하는 운영 체제 버전
	- Windows 7, 10 (64bit)
	- Linux (64bit, CentOS 7 권장)
	- Mac OS 10.8.3 이후
- 동작에 필요한 하드웨어 요건
	- 메모리: 4GB 이상
	- 1GB 이상의 빈 스토리지
	- 듀얼 모니터 사용 추천
- 동작에 필요한 소프트웨어 요건
	- Java Runtime and Development Kit (JDK) 설치
	- 필요에 따라 JDK의 bin 디렉터리를 OS의 PATH에 추가
---
- 기드라 설정
	1. ZIP 파일을 C:\Ghidra에 압축 해제
	2. 환경 변수 GHIDRA_INSTALL_DIR에 C:\Ghidra\ghidra_11.3_PUBLIC을 설정
		1. 11.3: 노트 작성 기준 최신 버전
		2. Windows 버전: 노트 작성 기준 최신 버전인 Windows 11
	3. Windows에서는 다음과 같이 실행
		- `C: \>set GHIDRA_INSTALL_DIR=C: \Ghidra\ghidra_11.3_PUBLIC`
		- Windows에서는 ghidraRun.bat을 실행
		- Linux나 Mac OS에서는 ghidraRun을 실행
	4. 처음 시작할 때는 User Agreement에 동의
# 프로젝트 설정
- 분석을 하려면 Project라고 하는 작업용 디렉터리를 작성
- 상단 메뉴 바 > File > New Project를 선택해 프로젝트 타입을 설정
	- Non-Shared Project: 보통 많이 사용
	- Shared Project: [[부록(리버스 엔지니어링 기드라 실전 가이드)|부록]]에서 설명
- 프로젝트 디렉터리와 프로젝트 이름을 입력하고 Finish
- 프로젝트를 생성하면 기본 화면 상단에 CodeBrowser와 Version Tracking 버튼이 추가
	- Version Tracking: [[부록(리버스 엔지니어링 기드라 실전 가이드)|부록]]에서 설명

# 분석 파일 임포트
- 분석 대상 파일을 프로젝트 부분으로 드래그 앤 드롭
- 메뉴에서 File > Import File을 선택헤 다이얼로그부터 임포트
### 옵션
- 자동으로 프로그램의 포맷이나 언어가 선택
	- 보통 기드라가 자동 설정한 설정으로 문제가 없음
	- 만약 인식하지 못한 경우 Raw Binary 설정으로 선택됨
- 정정이 필요하면 수동으로 변경 가능

### Analyze
- Import가 종료되면 프로그램 데이터 구조 분석이 가능
- 표시된 프로그램을 더블 클릭 > CodeBrower가 열리고 Analyze할지 확인
	- Yes 버튼을 누르면 옵션 선택 창이 표시
	- 기본 설정으로도 문제는 없음

# CodeBrowser
- Ghidra의 주요 기능인 소프트웨어 리버스 엔지니어링을 수행하기 위한 도구
- 기본적으로 6개의 창이 표시
	- Program Trees: 프로그램을 분석해 Fragment라는 단위로 분할해 표시
		- PE 형식의 파일은 헤더나 섹션으로 분할
	- Symbol Tree: 프로그램 내의 심볼에 관한 정보
	- Data Type Manager: 프로그램 내의 데이터 타입의 정보
	- Listing: 프로그램을 디스어셈블한 결과
	- Decompile: 디스어셈블한 결과를 C 언어로 디컴파일한 결과
	- Console: Ghidra Script 및 Ghidra Extension 출력

## 권장 설정
1. 하이라이트
	- 기본 설정: Listing 창과 Decompile 창에서 마우스 스크롤을 누르면 대상 문자열이 강조
	- 보통 마우스 왼쪽 버튼을 많이 이용하기 때문에 이를 변경
		- 상단 메뉴 > Edit > Tool Options
		- 왼쪽의 탭 중 Listing Fields > Cursor Text Highlight 선택
		- Mouse Button To Activate를 MIDDLE에서 LEFT로 변경
2. 키 바인딩
	- 자주 사용하는 항목을 사용하기 간단한 단축키로 변경
	- Edit > Tool Options > Key Bindings부터 설정
	- 항목을 선택, 하단의 텍스트 상자에서 설정하고자 하는 키 바인딩을 입력
	- 설정된 키 바인딩을 취소하려면 텍스트 상자에서 Enter 또는 Backspace
		- Previous Data Type in
			- History 창에서 이전에 커서가 있던 위치로 돌아감
			- 예시로 Esc를 설정
		- Find References To
			- Listing 창에서 대상 주소를 참조하는 주소 알림 표시
			- 예시로 X를 설정
		- Find References to Symbol
			- Decompile 창에서 대상 주소를 참조하는 주소 알림 표시
			- 예시로 X를 설정
	- 원하는 대로 설정 가능
3. 어셈블리 언어의 행간
	- 기본 설정에서는 디스어셈블 결과의 헥스 코드의 바이트 열을 3행으로 표시
		- 이대로는 디스어셈블한 어셈블리 언어의 행간을 읽기 어려움
		- 1행으로 표시하도록 설정
	- Edit > Tool Options > Listing Fields > Bytes Field > Maximum Lines To Display
		- 3에서 1로 변경
		- 숨겨진 바이트 열은 마우스로 확인 가능

## Listing 창
디스어셈블한 명령이나 참조하는 데이터를 표시하거나 조작하는 창이다. 
- 주소(Address): 00401020처럼 Ghidra가 프로그램을 읽고 메모리에 로드하는 가상 주소의 값
- 바이트(byte): `e8 ec 02 00 00`처럼 디스어셈블된 명령어와 대응하는 헥스 코드의 바이트 열
- 어셈블리어(assembler language): 실행할 명령 표시
- 오퍼랜드(Operand): 레지스터, 수치, `DAT_00402211`, `LAB_00402031`이나 `FUN_00401000`등의 라벨 등 조작과 연산 대상이 되는 오퍼랜드 표시
- XREF: 함수와 데이터 영역 참조에 대한 링크 표시, 클릭하면 점프, [ ] 안에는 피참조 수 표시
- 함수 정보: 함수 이름이나 인수 정보는 함수 선두에 표시
- 문자열

### 함수 정보 편집
함수의 맨 처음에 나오는 명령을 우클릭하고 메뉴에서 [Edit Function]을 클릭하면 함수 정보를 편집할 수 있다. 이 때 편집 가능한 정보는 함수 이름, 인수, 반환값, 호출 규약이다. 
![[Pasted image 20250904005547.png]]

### 라벨 정보 편집
Listing 창에 표시되는 함수 이름이나 변수 이름 등의 라벨(`FUN_00402000, LAB_00402300` 등)을 우클릭한 후 메뉴에서 [Edit Label]을 클릭하면 라벨 정보 편집 화면이 열린다. 
![[Pasted image 20250904010209.png]]

각 항목은 다음과 같다. 
- Enter Name: 변경할 이름 입력
- Namespace: 라벨 네임스페이스 지정
- Properties: 라벨 속성 정보 변경
- Entry Point: 엔트리 포인트 설정
- Primary: 여러 개의 라벨이 있을 때 1차 라벨로 해당 라벨을 설정
- Pinned: 이미지 기반 변경이나 메모리 블록 이동의 영향을 받지 않도록 라벨 고정

### 엔트로피
엔트로피는 정보량을 나타내는 값으로, 일반적으로 데이터가 암호화되어 있거나 인코딩되어 있을 경우 높아진다.
표시하려면 Listing 창 윗 부분의 [Toggle overview margin displays] 버튼에서 [Show Entropy]를 선택한다. 이 표시는 선택할 때마다 체크 온/오프를 바꾸며, 0에서 8까지의 엔트로피 값에 따라 분류되어 있어 데이터 개요를 파악할 수 있다.
![[Pasted image 20250904015509.png]]
이 사진에서 초록색이 주 색상인 것은 [Show Entropy]를 On한 것이며, 빨간색이 주 색상인 것은 [Show Overview]를 On한 것이다. 
또한, 이 막대를 우클릭해 [Show Legend]를 키면 다음과 같은 사진을 볼 수 있다. 
![[Pasted image 20250904020328.png]]
이 사진은 [Show Overview]에 대한 것이며, 

![[Pasted image 20250904020336.png]]
이 사진은 [Show Entropy]에 대한 것이다. 

### 오버뷰
위에서 나온 Overview는 프로그램에 존재하는 다양한 데이터의 유형을 색칠해 시각적으로 나타낸 것으로, 이를 통해 프로그램의 전체 구성을 파악할 수 있다. 

- Function: 정의된 함수
- Uninitialized: 이외의 초기화되지 않은 영역
- External Reference: 외부 프로그램에 대한 참조
- Instruction: 함수로 정의되지 않은 명령
- Data: 정의된 데이터
- Undefined: 정의되어 있지 않은 데이터

### 흐름 화살표
Listing 창 왼쪽의 여백 부분에 표시되어 실행 흐름을 볼 수 있다. 
조건부 분기는 점선, 무조건 분기는 실선으로 표시되며, 점프원에 커서를 두고 해당 주소를 클릭하면 선이 굵어진다. 화살표에 커서를 올려놓으면 어디서 시작하고 끝나는지와 어떤 분기 타입인지 알 수 있고 클릭하면 녹색의 굵은 선이 된다. 화살표를 더블 클릭해서 점프처와 점프원에서 서로 이동할 수 있다. 
![[Pasted image 20250904030211.png]]

### 주석
Ghidra를 사용하면서 주석을 붙이고 싶은 행에서 우클릭 한 후 메뉴에서 [Comment]를 선택하면 Listing 창에 원하는 주석을 입력할 수 있다. 
정적 분석에서는 파악한 정보를 까먹지 않게 써놓을 수 있고, 이는 디스어셈블 과정을 더욱 편리하게 해 줄 것이다.
코멘트는 다섯 가지의 종류가 있고 콘텍스트 메뉴의 서브 메뉴로 표시되므로 거기서 지정한다. 

- EOL(End-of-line) Comment
	- 오퍼랜드 오른쪽에 표시되며, Ghidra가 자동으로 표시하는 Windows API 등도 표시된다.
- Plate Comment
	- 어셈블리어의 상부에 `*`로 둘러싸인 헤더로 표시되며, 함수나 외부 라이브러리의 최상단에 표시된다. 
	- 그 영역이 어떤 영역인지, 라이브러리 이름, 심벌 정보 등이 표시되며, Ghidra가 붙인 주석은 편집 화면에 표시되지 않지만 주석을 추가하면 원래 있던 주석에 덮어 써진다. 
- Post Comment
	- 어셈블리어 하단에 표시된다. 
- Pre Comment
	- 어셈블리어 상단에 표시된다. 
- Repeatable Comment
	- EOL Comment가 없을 경우 운영자 오른쪽에 표시된다. 
	- 주석 붙인 영역을 참조하는 영역에도 표시된다. 
	- 이미 EOL Comment나 Repeatable Comment가 있으면 표시되지 않는다.
![[Pasted image 20250904030650.png]]

## Decompile 창
Listing 창과 연동해서 나타난다. Decompile 창에서는 현재 표시 중인 어셈블리 언어를 C 언어로 변환해 보여주기 때문에 변수 대입이나 함수의 인수, 조건 분기 등을 이해하기 쉽다. 
![[Pasted image 20250904031801.png]]

### 마우스 조작
- 좌클릭: 선택 부분 Highlight
- 우클릭: 메뉴 표시
- 중앙 클릭 (마우스 휠 클릭): 일치하는 문자열 모두 Highlight
- 더블 클릭: 대상이 함수 등의 링크일 경우 해당 링크로 이동
- Ctrl + 더블 클릭: 별도 창에서 대상을 Snapshot으로 표시

### 하이라이트
![[Pasted image 20250904031859.png]]
해당 메뉴에서 Highlight는 다음 다섯 가지 종류가 있다. 

- Def-use: 선택한 변수가 사용되는 모든 것을 강조 (단, 변수 정의 부분은 강조되지 않음)
- Forward Slice: 선택한 변수에 영향을 받을 수 있는 변수 강조
- Backward Slice: 선택한 변수에 영향을 줄 수 있는 함수 내의 모든 변수 강조
- Forward Operator Slice: Forward Slice에서 강조되는 변수가 포함된 명령 전체 강조
- Backward Operator Slice: Backward Slice에서 강조되는 변수가 포함된 명령 전체 강조

### 커밋
Ghidra는 디스어셈블된 코드를 바탕으로 대상 컴파일 결과를 표시한다. 우클릭으로 나타나는 메뉴에서 [Commit]을 선택하면 Decompile 창에서 편집한 정보를 데이터베이스에 저장하고 Listing 창의 정보와 Decompile 창의 정보를 동기화한다. 
[Commit Params/Return]은 함수의 인수와 반환값의 정보를, [Commit Locals]는 로컬 변수의 정보를 각각 동기화한다. 

### 검색
[Ctrl + F]를 누르거나 아무 데나 우클릭하고 [Find]를 선택해 나타나는 창으로 문자열을 검색할 수 있다. 
[Format]의 [String]은 문자열의 부분 일치 검색, [Regular Expression]은 정규 표현식을 사용해 검색할 수 있다. ![[Pasted image 20250904035119.png]]

## Symbol Tree 창

## Data Type Manager 창

## Bookmarks 창

## Bytes 창

## Function Graph 창

## 여러 창에서 공통적인 항목
