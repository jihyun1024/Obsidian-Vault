---
tags:
  - 수업_정리
  - 암호학
title: 전력분석모델과 1차 전력분석
---
## 학습 주제
1. HW 모델, HD 모델
2. SPA 기반 암호 알고리즘 공격 위치 탐지
3. Pop Quiz

---
## 연관 수업
[[부채널 공격 및 대응]]

---
## 강의 요약
이번 수업에는 부채널 공격에 사용되는 모델을 위주로 알아볼 것이다.
### HW 모델, HD 모델
Power Model에 대해 알아보자. 
Power Model이란, 암호 알고리즘이 동작 중일 때 해당 디바이스에서 소비하는 실제 전력량을 예측하기 위한 모델로, Hamming Weight 모델과 Hamming Distance 모델 두 가지가 있다. 

이를 통해 전력 정보와 암호키 사이의 상관관계를 유추할 수 있다. 

$P_{total}$: 총 전력 소비, $P_{noise}$: 잡음, $\epsilon$: 상수 라고 가정할 때, 
- $HW(y)$
	- Hamming Weight 모델
	- 데이터 $y$의 이진수 표현 시 **1의 개수**
		- ex: $y$ = $1011_2$ 일 경우, $HW(y) \ = \ 3$ 
- $HD(x,y)$
	- Hamming Distance 모델
	- $x, y$의 이진수 표현 시 **같은 위치에서 서로 다른 이진수 값의 개수**
		- ex: $x = 0111_2,\  y = 1011_2$일 경우, $HD(x, y) = 2$

이는 다음의 사진처럼 직관적으로 나타낼 수 있다. 
![[Pasted image 20251002081020.png]]

Hamming Weight 모델의 경우, 전력 소비 값이 Hamming Weight 값에 비례한다는 특징이 있다.
Hamming Distance 모델의 경우, S-Box Input과 Output과의 관계를 분석하는 데 도움이 된다. 

위의 사진의 HD 모델의 그래프에서 Voltage는 전력이고, Transitions는 비트 반전 횟수이다. 즉, **비트 반전 횟수가 많을수록 그에 맞춰 전력 사용량 또한 같이 올라간다.**

### SPA 기반 암호 알고리즘 공격 위치 탐지
**SPA(Single Power Analysis, 단순 전력 분석)** 란 암호 동작 동안에 수집된 전력 파형을 시각적으로 분석하는 기술로, 장치에서 실행되고 있는 암호 알고리즘을 알고 있다는 가정을 바탕으로 한다. 

공격 목적은 한 개 또는 소수의 전력 파형을 통해 알고리즘의 비밀키를 찾아내는 것으로 한다. 
즉, L2R Method에서 곱해지는 수인 d를 찾아내는 것을 목적으로 한다.
#### RSA Analysis
RSA 알고리즘에서 L2R method를 예시로 들자. 
![[Pasted image 20251002084605.png]]
우리가 관심있는 과정은 복호화 과정이기 때문에 $M = C^d \ (mod\  N)$ 계산에서 d만 찾으면 된다. 
이 때, 알고리즘을 유심히 살펴보면 알겠지만, $d_i = 1$일 때만 연산이 하나 더 붙는 것을 알 수 있다. 즉, 곱셈 연산(M)에 비해 제곱 연산(S)이 75%의 연산량으로도 동작할 수 있다. 

그렇다면, 아래 그림에서 Key인 $d$를 정답 없이도 알 수 있을까?![[Pasted image 20251002085017.png]]
답은 '그렇다'이다. 그 이유는 수학적 기반인 L2R Method에서 찾을 수 있다. 

1. M 앞뒤로 무조건 S가 동작한다. ($d_i$가 1일 때는 S, M이 한 세트로 1이다)
2. S는 앞뒤로 S(이 경우는 $d_i$가 0인 경우) 또는 M이 나올 수 있다. 

따라서, 아래의 사진에서의 Key도 답지 없이도 해석할 수 있어야 한다. 
![[Pasted image 20251002085307.png]]
이 파형 그래프는 위의 사진과 다르게 연산량을 나타낸 것으로, 방금 전 L2R Method에서 곱셈 연산에 비해 제곱 연산이 75%의 연산량만으로 동작할 수 있다는 것을 기반으로 해석할 수 있다. 

그렇다면, 이 때 S, M을 분리해서 해석해도 다시 제대로 해석할 수 있는 이유가 왜인지 궁금할 수 있을 것이다. 그 답은 의외로 간단한데, 바로 **우리가 이미 암호 알고리즘에 대해 알고 있기 때문에 키 길이 또한 알고 있기 때문이다.** 
따라서 위의 그림을 잘못 해석해 비트 길이가 반토막이 나도 재해석해서 $d$를 찾을 수 있다. 
#### AES Analysis
앞에서는 RSA에 대해 분석할 수 있었고, 지금은 AES에 대해 분석해 볼 것이다. 

AES 암호화 알고리즘 동작 시 전력 소비 파형은 다음과 같다. 
![[Pasted image 20251002090237.png]]
이 때 10번 구간이 조금 짧은 이유는 알고 있다시피 마지막 라운드에서는 MixColumns 연산을 수행하지 않기 때문이다. 

1 Round를 확대한 그림과 그 안의 SubBytes 연산을 확대한 그림은 다음과 같다. 
![[Pasted image 20251002090419.png|350x200]]![[Pasted image 20251002090440.png|350x200]]
이 파형들을 통해 반복되는 연산과 파형 사이의 관계를 파악해서 어떤 연산이 실행 중인지 파악할 수 있다. 또한, 같은 AES-256 알고리즘이라도 구현한 알고리즘이나 사용 중인 하드웨어에 따라 전력 소모 패턴이 각각 다르기 때문에 파형 또한 전부 다른 것을 교재에서 확인할 수 있다. 

### Pop Quiz
그러면 문제를 하나 풀어 보자. 
다음 두 개의 전력 파형을 보고, 알고리즘 후보군이 있을 때 각각 어떤 알고리즘인지 맞히면 된다.

![[Pasted image 20251002090913.png]]

Q1 먼저 Zoom in 해보자. 
![[Pasted image 20251002090944.png]]
![[Pasted image 20251002091000.png]]

그 다음은 Q2를 Zoom in 해보자. 
![[Pasted image 20251002091025.png]]
![[Pasted image 20251002091037.png]]

후보 알고리즘은 다음과 같다. (알고리즘 그림은 알아서 찾아보며 공부하자...)
1. DES
	- 16 Round
	- 블록 크기: 64-bit, 키 길이: 56-bit
2. LEA-128
	- 24 Round
	- 블록 크기: 128-bit, 키 길이: 128-bit
3. ARIA-128
	- 12 Round
	- 블록 크기: 128-bit, 키 길이: 128-bit
4. SEED-128
	- 16 Round
	- 블록 크기: 128-bit, 키 길이: 128-bit

그럼 풀어 보자. 

먼저, 전체적인 파형을 관찰해 보면 Q1과 Q2 둘 다 16번을 비슷한 연산을 반복하는 것을 알 수 있으며, 후보군 알고리즘 전부 대칭키 암호이기 때문에 라운드가 존재한다. 
따라서, Q1과 Q2는 DES 또는 SEED 둘 중 하나로 좁혀지지만, 이것 가지고는 확정할 수 없다.

1. Q2를 1번 Zoom in한 사진에서 1 Round가 4개의 덩어리로 나눠지는 것을 확인할 수 있다. 
2. Q1을 2번 Zoom in한 사진에서 1 Round의 중간의 덩어리가 초기의 어떤 것일지 모르는 연산을 제외하면 8개의 덩어리로 나눠지는 것을 확인할 수 있다.
3. Q2를 2번 Zoom in한 사진에서 3개의 덩어리를 확대한 사진을 보면 각 2개씩 총 6개의 덩어리로 나눠지는 것을 확인할 수 있다. 

여기까지 왔다면 알겠지만, Q1이 DES이고, Q2가 SEED-128이다. 

1번에서 4개의 덩어리로 나눠진 사진에서 처음 덩어리는 XOR 연산 3번이 동작할 때의 파형이며, 나머지 3개의 덩어리는 G함수 + 덧셈으로 구성된 F함수가 3번 동작하는 것을 의미한다. 

2번에서 8개의 덩어리로 나눠진 것은 S-Box를 참조한 것이며, S-Box는 특성상 행과 열을 각각 참조하기 때문에 각 덩어리마다 또 두 덩어리로 나눠진다. 


이렇게, 암호 알고리즘이 동작한 동안 측정한 전력 파형을 가지고 암호 알고리즘의 키를 알아낼 수도 있지만, 반대로 어떤 암호 알고리즘이 동작했는지 또한 암호에 관한 지식이 있다면 알아낼 수 있는 것을 직접 체험해 봤다. 

---
## 중요한 단어
1. Hamming Weight Model
2. Hamming Distance Model
3. SPA (Single Power Analysis)
4. L2R Method
