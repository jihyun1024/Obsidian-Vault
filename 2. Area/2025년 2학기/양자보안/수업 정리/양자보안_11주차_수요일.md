---
tags:
  - 수업_정리
  - 암호학
title:
---
## 학습 주제
1. NTT definition
2. NTT preliminaries
3. NTT computation
4. Addition and Multiplication in $Q_i$

---
## 연관 수업
[[양자보안_9주차_월요일]]
[[양자보안_9주차_수요일]]
[[양자보안_10주차_월요일]]
[[양자보안_10주차_수요일]]
[[양자보안_11주차_월요일]]

---
## 수업과 관련한 질문 3가지
1. $T_q$에서 덧셈, 곱셈 연산을 Component-wise하게 해도 문제가 없는지를 증명 가능한지
2. NTT의 역연산은 $T_q$에서 $R_q$로 변환하는 것인데, 원소들을 어떻게 7차식으로 합칠 수 있는지
3. Bit reversal을 어떤 이유로 수행하는지

---
## 강의 요약
이번 수업에서는 복습의 비중이 매우 높다. 그만큼 NTT가 중요하다는 뜻이니, 열심히 공부하자. 
### NTT definition
![[Pasted image 20251113055137.png]]

$n = 256,\ q = 3329 \ (또는\ 8000000)$일 때, Kyber와 Dilithium과의 차이점은 $q-1$을 $2n$이 나눌 수 없는지 있는지가 Kyber와 Dilithium과의 차이점이었다. 

또한, $\zeta \in Z^*_q$가 각각 17 또는 1753일 때, $\zeta$는 order로 $n = 256$을 가지고 있어 부분 순환군을 이루고, ${\zeta}^\frac{n}{2} = -1$이라는 성질을 $Q_i$의 연산에 활용할 수 있었다. 

이 때, $i$가 홀수일 때 $Q_i = Z_q[x] / (x^2 - \zeta^i)$으로 Quadratic ring이라 불리며 해당 집합 내의 원소는 2차로 통제를 받게 된다. 이는 곱셈도 예외가 아니어서, $x^2 - \zeta^i = 0$이기 때문에 $x^2 = \zeta^i$라는 성질을 이용해 차수를 2차 미만으로 낮출 수 있다. 

$Q_i$ 여러 개로 이루어진 Ring인 $T_q = Q_1 \times Q_3 \times ... \times Q_{n-1}$에서는 **NTT** 연산이 일어나게 되는데, NTT란 $R_q$ 내부의 원소를 $T_q$로 옮겨 오는 작업이었다. 이를 통해 $R_q$에서 $256^2$번 하게 될 곱셈 연산을 $T_q$에서 $128 \times 4$번만 할 수 있게 되어 오버헤드가 많이 줄어들게 되었다. 

이를 자세하게 설명하기 위해 두 Ring $R_1, R_2$에 대해서 $R_1 \times R_2$ 연산을 수행하게 되면, $R_1 \times R_2 = \{(a, b) | a \in R_1,\ b \in R_2\}$가 된다. 
이 결과물도 Ring이 되기 때문에, $(a , b) + (x, y) = (a +x , b+y)$가 되며, $(a, b) \times (x, y) = (ax, by)$가 된다. 이는 연산이 **Component-wise**하게 수행된다는 의미가 되기 때문에, 계산량이 현저하게 줄어들게 된다. 

이 때 그 보내는 작업은 어떻게 하게 될까? 답은 NTT Preliminaries 단원에 있다. 

### NTT preliminaries
실제 Kyber와의 Parameter와는 백만광년 멀긴 하지만, 이해를 위해 $n = 8, q = 137$로 설정하자. 

이 때의 $R_{137} = Z_{137}[x] / (x^8 + 1)$이 되며, $\zeta = 10$일 때 order로 8을 가지게 되며, $\zeta^4  -1$이다.
NTT를 연산해 보면, $R_{137}$에서 $T_{137}$로 이동하는 것을 계산해야 하고, $T_q = Q_1 \times Q_3 \times Q_5 \times Q_7$이다. 이 때 $x^8+1$을 2차식까지 쭉 내려가도록 다음과 같이 $\zeta^4 = -1$임을 이용해 인수분해 가능하다. 
![[Pasted image 20251113055735.png]]

이는 최종적으로 $\zeta^i$ 앞의 부호가 전부 마이너스가 될 때까지 $\zeta^4 = -1$임을 이용해 변환하고, 인수분해하고, 변환하고, 인수분해하고를 반복하는 것과 동일하다. 

### NTT computation
NTT에서 원소의 변환에 사용되는 인수분해 과정을 그림으로 나타낸 것은 다음과 같다. 이때, 0은 $\zeta^i$ 앞의 부호가 $-$인 경우이며, 1은 $\zeta^i$ 앞의 부호가 $+$인 경우이다. 
![[Pasted image 20251113060207.png]]
위의 그림에서 $x^2 + \zeta = x^2 - \zeta^5$이며, $x^2 + \zeta^3 = x^2 - \zeta^7$이다. 

그러면 여기서 질문이 2개 생길 수가 있는데, 
첫 번째는 NTT 연산을 어떻게 빠르게 연산할 수 있을지, 그리고 두 번째는 $T_q$에서 다시 $R_q$로 돌아갈 때는 어떻게 다시 돌아갈 수 있을지이다. 

이 두 질문에 대한 답은 다음 강의에서 다루는 것으로 한다. 

### Addition and Multiplication in $Q_i$
$T_q$를 구성하는 Ring $Q_i$ 또한 Ring이기 때문에 **Addition과 Multiplication 연산**을 수행할 수 있다. 

이 때, $T_q$에서의 두 연산은 Component-wise한데, 이는 곧 같은 $i$값을 가지는 $Q_i$에서의 연산만 서로 수행하면 된다는 의미이다. 왜냐하면, $T_q$에서는 256차 대신 2차식 여러 개로 식을 통제하는데, 그 2차식 각각은 $\zeta$의 제곱 횟수가 전부 다르기 때문이다. 

$Q_i$에서의 Addition의 경우, 
$(a_0 + a_1x) + (b_0 + b_1x)= (a_0 + b_0) + (a_1 + b_1)x$로 익히 아는 다항식의 덧셈처럼 수행된다. 

$Q_i$에서의 Multiplication의 경우, 2차식이 나올 수 있는데 이는 다음처럼 2차 미만으로 정리된다. 
$(a_0 + a_1x) \times (b_0 + b_1x) = a_0b_0 + (a_0b_1 + a_1b_0)x + a_1b_1x^2 = (a_0b_0 + a_1b_1\zeta^i) + (a_0b_1+a_1b_0)x$ 
이렇게 정리할 수 있는 이유는 **여러 번 얘기했지만, $x^2 - \zeta^i = 0$이 되어 $x^2 = \zeta^i$이기 때문이다.** 

---
## 중요한 단어
1. NTT
2. Component-wise
3. NTT Preliminaries
4. Addition & Multiplication