---
tags:
  - 암호학
  - 3학년_2학기
title:
---
## 학습 주제
1. NTT Preliminaries
2. NTT Computation
3. NTT Example

---
## 연관 수업
[[양자보안_9주차_월요일]]
[[양자보안_9주차_수요일]]
[[양자보안_10주차_월요일]]
[[양자보안_10주차_수요일]]

---
## 수업과 관련한 질문 3가지
1. Quadratic Ring이 무슨 Ring을 의미하는 것인지
2. NTT의 역연산 과정에서 발생할 수 있는 오류나 취약점이 있을지
3. $Q_i$ 내부의 $c_0 + c_1x$ 다항식을 표현할 때, 순서쌍으로 표현해서 어떤 장점이 있을지

---
## 강의 요약
저번 강의에서 이어서, NTT에 대해 더 자세하게 다룬다. 
### NTT Preliminaries
이번 강의에서는 Addition and multiplication in $Q_i$ 단원을 건너뛴, **NTT Preliminaries**부터 진행한다. 저번 강의에서 다룬 내용으로, $R_q$에서 $T_q$로 넘어갈 때 $R_q$에서는 칸이 256개였고 각각의 칸이 $x^n + 1$이라는 다항식 하나에 의해 통제되었다면, $T_q$에서는 칸이 128개가 존재하고 각각의 칸은 $x^2 - \zeta^i$라는 다항식(단, $i$는 홀수)들에 의해 각각 통제된다는 것을 의미한다고 했다. 

이 내용에 대해 더 수학적으로 접근해 보자. (아래 사진을 참고하자)
![[Pasted image 20251111041950.png]]

여기서는 이해를 위해 $n = 8$, $q = 137$을 준비했다. 이 때, Kyber 암호에서는 $n$이 $q-1$을 나누지만, $2n$은 $q -1$을 나누지 못한다. 즉, 이 때의 $R_q$는 $Z_{137}[x]/(x^8+1)$이라고 설정할 수 있다. 

$\zeta = 10$이라 하면, ${Z^*_{137}}$에서 $\zeta$는 order로 8을 가지는, 즉 8번 제곱해서 1로 돌아오는 성질을 가지며, 그 절반인 4번 제곱하면 -1로 돌아온다는 말이기 때문에 ${\zeta}^4 = -1$이라고 할 수 있다.

이제, NTT에서 $R_q$에서 $T_q$로 공간이 바뀌는 것에 대해 이해해 보자. 저번 시간에 $x^2 - {\zeta}^i$는 $i$가 홀수일 때 Irreducible polynomial이라는 것을 증명해 본 적이 있다. (모르면 다시 공부해 보자)
우리는 $x^8 + 1$이 전체를 통제하는 대신 그보다 더 작은 이차식 여러 개가 부분부분 나눠서 통제하는 것을 원하기 때문에, $x^8 + 1$을 2차식 여러 개로 더 이상 분해가 불가능할 때까지 나눌 것이다.

$x^8 + 1$을 끝까지 나눠 보면 $(x^2 - \zeta)(x^2 - {\zeta}^5)(x^2 - {\zeta}^3)(x^2 - {\zeta}^7)$으로 나눌 수 있으며, 실제 Kyber에서 사용되는 $T_q$에는 이런 2차식이 4개가 아닌 $\frac{256}{2} = 128$개 만큼 등장한다. 

### NTT Computation
그렇다면, 해당 2차식들은 무엇을 하는 용도일까? 다음 그림을 살펴보자. 
![[Pasted image 20251111043152.png]]

이 그림을 앞의 예시를 바탕으로 해석해 보면, 원래는 최대 7차식이기 때문에 8칸을 각각 전부 연산해 $8^2 = 64$번 연산해야 했지만, $T_q$에서는 2차식으로 끊기 때문에, 다음처럼 표시된다. 
![[Pasted image 20251111043521.png]]

여기서, 콤마로 구분된 칸은 2차식의 개수인 4개로 각각의 칸은 최대 1차 다항식으로 배정되며, 전체적인 구조는 NTT 이전의 $R_q$와 동일하지만 $T_q$를 사용함으로써 **component-wise**하게 연산할 수 있게 되어 $2^2 \times 4 = 16$번만 연산하면 된다. 

이는 64번의 연산보다 4배 더 빠르게 연산할 수 있다는 의미가 되어 NTT에서 계산의 고속화를 이유로 $R_q$ 대신 $T_q$를 사용하는 근거가 된다. 

### NTT Example
예시를 들어 간단한 NTT 연산을 해 보자. 아까처럼 $q = 137$, $n = 2^3 = 8$인 경우를 가정하자. 

이 때, $\zeta = 10$이 $Z^*_{137}$에서 order가 8인 원소가 된다고 하며, $a(x) = 99 + 52x + 7x^3 + 29x^5 + 33x^6 + 100x^7 \in R_q$이고 $b(x) = 6 + 45x^2 + 12x^3 + 14x^4 + 78x^5 + 65x^6 + 112x^7 \in R_q$라고 하자. 
우리는 $c(x) = a(x)b(x)\ mod\ (x^8 + 1)$을 NTT를 사용해 계산하려고 한다. 

**이는 2번째 사진을 참고해서 계산할 수 있다.**

먼저, $a(x)$를 반반 나누는데, $x^4$를 기준으로 그것보다 작은 차수들은 $a_L(x)$로 그대로, 큰 차수들은 따로 분류해서 $x^4$로 나눠서 $a_R(x)$로 구분하면
$a_L(x) = 99 + 52x + 0x^2 +7x^3$
$a_R(x) = 0+29x + 33x^2 + 100x^3$로 계산된다. 

이후, $mod \ (x^4 - {\zeta}^2)$ 연산과 $mod \ (x^4 + {\zeta}^2)$ 연산을 진행한다. (이 연산도 반반 나누는 연산이다)
$mod\ (x^4 - {\zeta}^2)$에서는 $x^4 = {\zeta}^2$이며, $mod\ (x^4 + {\zeta}^2)$에서는 $x^4 = -{\zeta}^2$임을 이용해 연산 가능하다. 

수식으로 쓰기엔 귀찮으니 사진으로 대체한다. *(시간 날 때 한 번 손으로 써 보자)*
![[Pasted image 20251111045953.png]]
이 때, $a_L(x)$와 $a_R(x)$를 굳이 계산한 이유가 바로 $mod$ 연산 때문임을 알 수 있다. 

그리고 나서 이 사진처럼 더 잘게 나눠서 계산할 수 있다. 
![[Pasted image 20251111050202.png]]
이는 ${\zeta}^4 = -1$임을 이용해 $x^4 + {\zeta}^2$ 다항식을 인수분해 할 수 있도록 함으로 가능하다. 
**(Remind: $x^2 - {\zeta}^{홀수}$은 Irreducible polynomial임은 이미 증명되어 있다.)**

따라서, 최종적으로 NTT에서 $a(x)$를 나타내는 $\hat{a} = NTT(a(x)) = (82+135x, 18+83x, 116+15x, 43+112x)$로 변환해 표현할 수 있다. 

---
## 중요한 단어
1. NTT Preliminaries
2. NTT Computation
3. component-wise
4. NTT Example
