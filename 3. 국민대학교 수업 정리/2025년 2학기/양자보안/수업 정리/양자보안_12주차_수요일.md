---
tags:
  - 수업_정리
  - 암호학
title:
---
## 학습 주제
1. NTT example
2. $NTT^{-1}$ (Kyber)
3. NTT computation
4. Kyber NTT
5. NTT (Number Theoretic Transformation)
6. NTT의 수학적 구조
7. Crystals-Kyber & Crystals-Dilithium의 안전성 비교
8. Parameter sets of Kyber & ML-KEM
9. Lattice

---
## 연관 수업
[[양자보안_9주차_월요일]]
[[양자보안_9주차_수요일]]
[[양자보안_10주차_월요일]]
[[양자보안_10주차_수요일]]
[[양자보안_11주차_월요일]]
[[양자보안_11주차_수요일]]
[[양자보안_12주차_월요일]]

--- 
## 수업과 관련한 질문 3가지
1. $n^{th}\ Root\ of\ 1$이라는 표현이 Cyclic subgroup의 Generator와 동일한 개념인지
2. Bit reversal을 왜 수행하는지
3. $R_q$를 더 쌓아 올려 보안강도가 증가할 때, NTT나 기타 연산들은 어떻게 바뀌어서 연산하는지

---
## 강의 요약
전반적인 내용은 [[양자보안_12주차_월요일]] 강의에서 바로 이어지는 내용이다. NTT 거의 마지막 부분이고, 이 수업이 끝나면 다른 내용을 공부할 것이다. 
### NTT example
![[Pasted image 20251119213028.png]]
이 사진을 참고하자. 

그러고 나서, 4등분 된 $a(x)$를 다시 7차식으로 변환하기 위해서는 NTT의 역과정을 거쳐야 한다. 이 과정은 아래의 $NTT^{-1}$ (Kyber)에 잘 설명되어 있다. 

### $NTT^{-1}$ (Kyber)
NTT의 역과정은 다음 사진처럼 계산할 수 있다. 
![[Pasted image 20251119213530.png]]
여기서, 왜 2의 역원인 $\frac{1}{2}$를 정수 형태로 찾았을까? 정답은 사람은 분수를 이해할 수 있지만, 컴퓨터는 분수를 이해할 수 없기 때문에 $\frac{1}{2}$ 대신 2의 역원이 되는 정수를 $Z_{137}$ 내부에서 찾아 NTT의 역연산 과정에 참고하기 위함이다. 

만약 $Z_{137}$에서 100의 역원을 찾고자 한다면, 그 역원을 찾는 과정은 **Extented Euclidean Algorithm**으로 구할 수 있다. 해당 과정은 사진 밑에 써 놨으니 나중에 참고하자. 

Extended Euclidean Algorithm은 gcd를 구하는 Euclidean Algorithm과 달리, 해당 gcd로부터 반대로 $ax+by = gcd(a,b)$를 만족하는 정수해 $x, y$를 계산하는 알고리즘이다. 
사진에서도 알 수 있듯, 137과 100은 서로소라는 것을 알 수 있으며, gcd를 구하는 과정을 역추적해 100의 역원은 $Z_{137}$에서 37이 된다는 것을 알 수 있다. 

### NTT computation
예시를 들어 NTT의 과정을 손으로 계산하는 과정은 다음 사진과 같다. ![[Pasted image 20251119215217.png]]

이 때, $Z_6$와 $Z_2 \times Z_3$은 서로 isomorphic한 것이며, 둘의 원소를 Mapping하는 방법은 $Z_6$에서의 원소를 각각 $Z_2$와 $Z_3$으로 제한시켜 얻은 나머지를 각각의 순서쌍에 넣는 방식을 사용한다.

### Kyber NTT
Kyber(ML-KEM)에서는 보안 강도에 상관없이 $q = 3329, n = 2^8 = 256, \zeta = 17$을 사용한다. 
또한, **Bit reversal**, 즉 비트 반전을 사용하는데, 예를 들어 103을 이진수로 표현한다면 큰 비트가 앞에 있다는 가정 하에 $103 = 64 + 32 + 4 + 2 + 1$이므로 103 = 1100111로 표현할 수 있는데, 이를 비트 반전하면 1110011으로, 10진수로 115가 된다. 
이는 Big-Endian과 Little-Endian과의 관계와 매우 비슷하다.

그렇다면, 이렇게 헷갈리는 Bit reversal을 수행하는 이유가 뭘까? 다음 사진에 그 이유가 있다. ![[Pasted image 20251119220541.png]]
정리하면, NTT의 성질과 관련이 있는데, ML-KEM의 경우 NTT는 $R_q$에서의 곱셈의 효율성을 높이기 위해 사용한다는 것을 알고 있을 것이다. 또한, $R_q$는 $T_q$와 동형이며 $T_q$는 $Z_q$의 128개의 quadratic extensions의 direct sum, 즉 $Q_0 \times Q_1 \times Q_2 \times ... \times Q_127$과 동등하다는 것 또한 알고 있다.

이 때 $NTT$, $NTT^{-1}$의 입/출력에 사용할 데이터의 구조는 $Z_q$의 정수 배열이며, 이 배열들은 각각 $T_q$ 또는 $R_q$의 원소가 된다. 

이 때 $BitRev7(i)$, 즉 각 배열의 비트의 순서를 바꾼 것은 사전에 계산해 저장할 수 있어 효율적으로 계산 없이 암호화나 복호화를 수행할 수 있다. 
따라서, **$BitRev$를 사용하는 이유는 사전 계산을 통한 효율적인 암/복호화를 위함이다.**

그렇다면, 이유도 알았으니, 아래 사진을 보자. ![[Pasted image 20251119220929.png]]
여기서 Definition 부분에 $\zeta$의 거듭제곱 대신 밑에 숫자가 있는 것을 확인할 수 있으며, 이걸 해석하면 2를 곱한다는 것은 왼쪽 비트 시프트 한 번 하고 나서 원래 비트가 있던 곳에 0을 채우는 것이고, 1을 더하면 그 자리에 1을 넣기 때문에 $2BitRev(i) + 1$은 무조건 홀수가 될 수 밖에 없다. 

이는 $0 \leq i \leq 127$일 때, $1 \leq 2BitRev(i) + 1 \leq 255$가 된다는 것을 의미하며, $2BitRev(i) + 1$은 항상 홀수이므로 $x^2 - \zeta_i$는 항상 기약다항식임을 알 수 있다.

### Crystals-Kyber & Crystals-Dilithium의 안전성 비교
이제 지긋지긋한 NTT에서 벗어나, 다른 내용을 보자. 
![[Pasted image 20251119221608.png]]

이 사진에서는 게이트 수를 연산 능력의 크기로 써 놨지만, 실제 게이트 수란 이 양자내성암호를 깨기 위해 필요한 양자 게이트의 총 개수를 의미하며 게이트가 많을수록 연산이 오래 걸리고, 오류 가능성도 커진다. **(게이트 수 = 시간 복잡도 = 얼마나 오래 걸리는지)**

마찬가지로, 메모리란 양자 알고리즘을 실행하는 데 필요한 큐비트 수를 의미하며, 양자 컴퓨터는 큐비트가 매우 제한적이고 비싸기 때문에 메모리가 클수록 필요한 큐비트의 수가 급격하게 늘어난다. **(메모리 = 공간 복잡도 = 얼마나 큰 양자 컴퓨터가 필요한지)**

### Parameter sets of Kyber & ML-KEM
![[Pasted image 20251119222138.png]]
이 사진에서는 **ML-KEM의 보안 강도**에 대하여 설명한다. 

여기서 공통적인 Parameter는 $n = 256, q = 3329$이며, 서로 다른 것 중 하나인 $k$는 보안 수준을 결정하는 역할을 수행한다. 

따라서, 표에서 볼 수 있듯 Kyber512는 AES-128, Kyber768은 AES-192, Kyber1024는 AES-256에 상응하는 보안 강도를 제공한다.
### Lattice
여태까지 NTT를 공부하면서 기초체력을 길렀다면, 이제부터는 격자 기반 암호인 ML-KEM과 ML-DSA에 사용되는 **Lattice(격자)** 에 대해 공부할 것이다. 

우리의 정보는 사진에서의 격자점에 존재하며, 독립적인 $n$개의 벡터들의 $Z$-linear, 즉 정수배 조합으로 정의할 수 있다. 
![[Pasted image 20251119225014.png]]
이 사진에서는 이해를 위해 2차원으로 간략하게 표현했지만, 실제로는 셀 수도 없는, 컴퓨터만 이해 가능한 차원으로 정보가 들어간다. 

Lattice에서 Hard한 Problem으로 **CVP(Closest Vector Problem)** 이 있는데, 이는 임의의 점에 가장 가까운 격자점을 찾는 문제로, 다음 예시를 보면서 이해해 보자. 
![[Pasted image 20251119225233.png]]

Lattice에 대해서는 기말고사 이전까지 공부할 것이니, NTT를 먼저 잘 이해해 놓자.

---
## 중요한 단어
1. Extended Euclidean Algorithm
2. Bit reversal
3. Bit reversal을 사용하는 이유
4. ML-KEM의 숫자별 보안 강도와 그에 해당하는 AES의 보안 강도
5. Lattice
6. CVP(Closest Vector Problem)